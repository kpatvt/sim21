>> # Depeopanizer test with some changes
>> units Field
>> $thermo = Sim21Thermo.Peng-Robinson
pkgName: Peng-Robinson
>> / -> $thermo
Thermo case attached to a unit operation. / to /thermo
>> thermo + Methane Ethane PROPANE
Methane Ethane PROPANE 
>> thermo + ISOBUTANE n-BUTANE ISOPENTANE n-PENTANE n-Hexane
ISOBUTANE n-BUTANE ISOPENTANE n-PENTANE n-Hexane 
>> thermo + n-Heptane n-Octane
n-Heptane n-Octane 
>> 
>> deprop = Tower.Tower()
>> deprop.Stage_0 + 18  # twenty stages`
>> 
>> cd deprop.Stage_0
/deprop.Stage_0
>> 
>> v = Tower.VapourDraw()
>> v.Port.P = 200
>> v.Port.Fraction.ISOBUTANE = .01
>> 
>> cond = Tower.EnergyFeed(0)
>> estT = Tower.Estimate('T')
>> estT.Value = 25
>> 
>> cd ../Stage_9
/deprop.Stage_9
>> f = Tower.Feed()
>> f.Port.T = 50
>> f.Port.P = 480
>> f.Port.MoleFlow = 1000
>> f.Port.Fraction = .1702 .1473 .1132 .1166 .1066 .0963 .0829 .0694 .0558 .0417
>> f.Port
Port: /deprop.Feed_9_f + sim21.old.solver.Ports.Port_Material
Connected to: None
VapFrac            = 0.001216070751314247 = 
T                  = 49.99999999999999 * F
P                  = 480.0 * psia
MoleFlow           = 1000.0000000000001 * lbmole/h
MassFlow           = 54388.326918000006 = lb/h
VolumeFlow         = 0.4158123456449343 = ft3/s
StdLiqVolumeFlow   = 0.3966768684715899 = ft3/s
H                  = -62299.579667023776 = Btu/lbmol
Energy             = -62289103.308412455 = Btu/hr
MolecularWeight    = 54.388326918 = 
ZFactor            = 0.13136681933414865 = 
METHANE            = 0.17020000000000002 * 
ETHANE             = 0.14730000000000001 * 
PROPANE            = 0.11320000000000001 * 
ISOBUTANE          = 0.11660000000000001 * 
N-BUTANE           = 0.10660000000000001 * 
ISOPENTANE         = 0.09630000000000001 * 
N-PENTANE          = 0.08290000000000002 * 
N-HEXANE           = 0.06940000000000002 * 
N-HEPTANE          = 0.05580000000000001 * 
N-OCTANE           = 0.04170000000000001 * 

>> 
>> cd ../Stage_19
/deprop.Stage_19
>> l = Tower.LiquidDraw()
>> 
>> l.c3flow = Tower.ComponentMoleFlowSpec()
>> l.c3flow + PROPANE
>> l.c3flow.Port = 12
>> 
>> reb = Tower.EnergyFeed(1)
>> #reb.Port.Energy = 8.42e6
>> estT = Tower.Estimate('T')
>> estT.Value = 250
>> 
>> cd ..
/deprop
>> 
>> /overhead = Stream.Stream_Material()
>> /overhead.In -> Stage_0.v.Port
>> 
>> /bottoms = Stream.Stream_Material()
>> /bottoms.In -> Stage_19.l.Port
>> 
>> 
>> 
>> TryToSolve = 1  # start calculation
Calculating Jacobian for /deprop
Calculating disturbance 10 of 20 in jacobian of /deprop
Calculating disturbance 20 of 20 in jacobian of /deprop
/deprop Inner Error 1.529796
/deprop Inner Error 0.236581
/deprop Inner Error 0.213206
Step size too small - Exiting inner loop
/deprop Iteration 1 Outer Error 0.104723
Calculating Jacobian for /deprop
Calculating disturbance 10 of 20 in jacobian of /deprop
Calculating disturbance 20 of 20 in jacobian of /deprop
/deprop Inner Error 0.050928
/deprop Inner Error 0.001467
Step size too small - Exiting inner loop
/deprop Iteration 2 Outer Error 0.015191
Calculating Jacobian for /deprop
Calculating disturbance 10 of 20 in jacobian of /deprop
Calculating disturbance 20 of 20 in jacobian of /deprop
/deprop Inner Error 0.187990
/deprop Inner Error 0.049681
/deprop Inner Error 0.010776
/deprop Inner Error 0.001740
/deprop Inner Error 0.000092
/deprop Inner Error 0.000002
Inner loop converged
/deprop Iteration 3 Outer Error 0.001262
/deprop Inner Error 0.013791
/deprop Inner Error 0.000381
/deprop Inner Error 0.000025
/deprop Inner Error 0.000001
Inner loop converged
/deprop Iteration 4 Outer Error 0.000223
/deprop Inner Error 0.000912
/deprop Inner Error 0.000042
/deprop Inner Error 0.000001
Inner loop converged
/deprop Iteration 5 Outer Error 0.000041
/deprop Inner Error 0.000038
/deprop Inner Error 0.000006
Inner loop converged
>> 
>> /overhead.Out
Port: /overhead.Out + sim21.old.solver.Ports.Port_Material
Connected to: None
VapFrac            = 1.0 = 
T                  = 24.44399647480806 = F
P                  = 200.0 = psia
MoleFlow           = 423.19681435237396 = lbmole/h
MassFlow           = 11883.530574250974 = lb/h
VolumeFlow         = 2.630932348791894 = ft3/s
StdLiqVolumeFlow   = 0.09296147048008174 = ft3/s
H                  = -37813.93780848387 = Btu/lbmol
Energy             = -16000046.982499372 = Btu/hr
MolecularWeight    = 28.08038689015053 = 
ZFactor            = 0.8615605176800891 = 
METHANE            = 0.4021769403613876 = 
ETHANE             = 0.34805725063502085 = 
PROPANE            = 0.23913220193982992 = 
ISOBUTANE          = 0.01 = 
N-BUTANE           = 0.0006334426054602141 = 
ISOPENTANE         = 1.3305349418609418e-07 = 
N-PENTANE          = 5.8302455103464806e-09 = 
N-HEXANE           = 1.4096971070510316e-09 = 
N-HEPTANE          = 1.0643466882760366e-09 = 
N-OCTANE           = 4.550408427003112e-10 = 

>> /bottoms.Out
Port: /bottoms.Out + sim21.old.solver.Ports.Port_Material
Connected to: None
VapFrac            = 1.571465273849596e-08 = 
T                  = 253.70449049976943 = F
P                  = 200.0 = psia
MoleFlow           = 576.803185647626 = lbmole/h
MassFlow           = 42504.79605584351 = lb/h
VolumeFlow         = 0.3774172082850433 = ft3/s
StdLiqVolumeFlow   = 0.30371539564646927 = ft3/s
H                  = -68604.2731697059 = Btu/lbmol
Energy             = -39564508.987570785 = Btu/hr
MolecularWeight    = 73.69029352711796 = 
ZFactor            = 0.06153788941338121 = 
METHANE            = 5.7343879564533283e-11 = 
ETHANE             = 5.687068128294694e-06 = 
PROPANE            = 0.02080434752890985 = 
ISOBUTANE          = 0.1948117227314154 = 
N-BUTANE           = 0.18434698655123774 = 
ISOPENTANE         = 0.16695459749248942 = 
N-PENTANE          = 0.14372319639597655 = 
N-HEXANE           = 0.12031833583841846 = 
N-HEPTANE          = 0.0967401029294255 = 
N-OCTANE           = 0.07229502340665481 = 

>> 
>> cd Stage_19
/deprop.Stage_19
>> delete l.c3flow
>> 
>> c = Tower.InternalLiquidClone()
>> c.Port.T = 255
/deprop Inner Error 0.001440
Inner loop is not changing significantly - exiting
/deprop Iteration 1 Outer Error 0.000008
Calculating Jacobian for /deprop
Calculating disturbance 10 of 20 in jacobian of /deprop
Calculating disturbance 20 of 20 in jacobian of /deprop
/deprop Inner Error 0.000154
/deprop Inner Error 0.000014
/deprop Inner Error 0.000000
Inner loop converged
>> 
>> /overhead.Out
Port: /overhead.Out + sim21.old.solver.Ports.Port_Material
Connected to: None
VapFrac            = 1.0 = 
T                  = 25.470491683595085 = F
P                  = 200.0 = psia
MoleFlow           = 426.08952670431404 = lbmole/h
MassFlow           = 12011.300679698874 = lb/h
VolumeFlow         = 2.6538903972017907 = ft3/s
StdLiqVolumeFlow   = 0.09392737895769626 = ft3/s
H                  = -37861.60083864447 = Btu/lbmol
Energy             = -16129718.736038744 = Btu/hr
MolecularWeight    = 28.18961661159665 = 
ZFactor            = 0.8613521379463718 = 
METHANE            = 0.3994465427134968 = 
ETHANE             = 0.3456966004738734 = 
PROPANE            = 0.2442573372625869 = 
ISOBUTANE          = 0.01 = 
N-BUTANE           = 0.0005993616452165924 = 
ISOPENTANE         = 1.2183663190987474e-07 = 
N-PENTANE          = 5.320288445031044e-09 = 
N-HEXANE           = 1.3511938599159251e-09 = 
N-HEPTANE          = 1.0442120978429376e-09 = 
N-OCTANE           = 4.506894101454554e-10 = 

>> /bottoms.Out
Port: /bottoms.Out + sim21.old.solver.Ports.Port_Material
Connected to: None
VapFrac            = 0.0 = 
T                  = 254.99987271779813 = F
P                  = 200.0 = psia
MoleFlow           = 573.9104732956862 = lbmole/h
MassFlow           = 42377.02588244257 = lb/h
VolumeFlow         = 0.3767661163068211 = ft3/s
StdLiqVolumeFlow   = 0.3027494866140095 = ft3/s
H                  = -68648.7220125318 = Btu/lbmol
Energy             = -39391595.29782726 = Btu/hr
MolecularWeight    = 73.83908789657055 = 
ZFactor            = 0.06162945659173241 = 
METHANE            = 2.033685065089424e-08 = 
ETHANE             = 4.006061753408466e-06 = 
PROPANE            = 0.015898832999737104 = 
ISOBUTANE          = 0.1957432353502447 = 
N-BUTANE           = 0.18529827077310507 = 
ISOPENTANE         = 0.1677961155399096 = 
N-PENTANE          = 0.1444476126337734 = 
N-HEXANE           = 0.12092478296438873 = 
N-HEPTANE          = 0.09722770737156994 = 
N-OCTANE           = 0.07265941596866726 = 

>> 
>> c.Port.T = None
>> c.c3spec = Tower.MassFractionSpec()
>> c.c3spec + PROPANE
>> c.c3spec.Port = .02
/deprop Inner Error 0.010506
Inner loop is not changing significantly - exiting
/deprop Iteration 1 Outer Error 0.004719
Calculating Jacobian for /deprop
Calculating disturbance 10 of 20 in jacobian of /deprop
Calculating disturbance 20 of 20 in jacobian of /deprop
/deprop Inner Error 0.009521
/deprop Inner Error 0.001671
/deprop Inner Error 0.000088
/deprop Inner Error 0.000029
/deprop Inner Error 0.000003
Inner loop converged
/deprop Iteration 2 Outer Error 0.015061
/deprop Inner Error 0.002057
/deprop Inner Error 0.000178
/deprop Inner Error 0.000022
/deprop Inner Error 0.000002
Inner loop converged
/deprop Iteration 3 Outer Error 0.001658
/deprop Inner Error 0.000214
/deprop Inner Error 0.000021
/deprop Inner Error 0.000001
Inner loop converged
/deprop Iteration 4 Outer Error 0.000296
/deprop Inner Error 0.000020
/deprop Inner Error 0.000002
Inner loop converged
/deprop Iteration 5 Outer Error 0.000059
/deprop Inner Error 0.000001
Inner loop converged
>> 
>> /overhead.Out
Port: /overhead.Out + sim21.old.solver.Ports.Port_Material
Connected to: None
VapFrac            = 0.9999897181808555 = 
T                  = 22.19682098341265 = F
P                  = 200.0 = psia
MoleFlow           = 415.7035297593984 = lbmole/h
MassFlow           = 11552.271973738749 = lb/h
VolumeFlow         = 2.575331467335336 = ft3/s
StdLiqVolumeFlow   = 0.09045707935508773 = ft3/s
H                  = -37680.41630061492 = Btu/lbmol
Energy             = -15661248.005150978 = Btu/hr
MolecularWeight    = 27.7896889796867 = 
ZFactor            = 0.8625584518251465 = 
METHANE            = 0.4094264007180933 = 
ETHANE             = 0.35432571799220725 = 
PROPANE            = 0.22557127926617554 = 
ISOBUTANE          = 0.01 = 
N-BUTANE           = 0.0006762428838837816 = 
ISOPENTANE         = 1.356638843616225e-07 = 
N-PENTANE          = 5.736678756607472e-09 = 
N-HEXANE           = 1.2146826643054044e-09 = 
N-HEPTANE          = 8.604910585200964e-10 = 
N-OCTANE           = 3.5613979952173276e-10 = 

>> /bottoms.Out
Port: /bottoms.Out + sim21.old.solver.Ports.Port_Material
Connected to: None
VapFrac            = 0.0 = 
T                  = 250.38719473343278 = F
P                  = 200.0 = psia
MoleFlow           = 584.2964702406015 = lbmole/h
MassFlow           = 42836.05222937425 = lb/h
VolumeFlow         = 0.37910832049484083 = ft3/s
StdLiqVolumeFlow   = 0.30621976703040177 = ft3/s
H                  = -68491.18840813854 = Btu/lbmol
Energy             = -40012429.96820251 = Btu/hr
MolecularWeight    = 73.3121872377844 = 
ZFactor            = 0.06130598097716533 = 
METHANE            = 7.667800178233052e-11 = 
ETHANE             = 9.495772076026621e-06 = 
PROPANE            = 0.03325233676100579 = 
ISOBUTANE          = 0.19244147607447837 = 
N-BUTANE           = 0.18196050953793186 = 
ISOPENTANE         = 0.16481349538940418 = 
N-PENTANE          = 0.14188002467498367 = 
N-HEXANE           = 0.1187753187461061 = 
N-HEPTANE          = 0.09549946385832782 = 
N-OCTANE           = 0.07136787910900819 = 

>> 
>> #Now test TriggerSolve
>> cd /
/
>> deprop.TriggerSolve = 1
/deprop Inner Error 0.000000
Inner loop converged
/deprop Iteration 1 Outer Error 0.000012
/deprop Inner Error 0.000000
Inner loop converged
>> deprop.TryToSolve = 0
>> 
>> 
>> #Lets trigger a solve
>> deprop.TriggerSolve = 1
/deprop Inner Error 0.000000
Inner loop converged
/deprop Iteration 1 Outer Error 0.000002
/deprop Inner Error 0.000000
Inner loop converged
>> deprop.TriggerSolve
/deprop.TriggerSolve = 0 
>> deprop.TryToSolve
/deprop.TryToSolve = 0 
>> 
>> 
>> #Lets change a spec
>> deprop.Stage_19.c.c3spec.Port = 0.01
>> 
>> #Everything is forgotten. trigger a solve
>> deprop.TriggerSolve = 1
/deprop Inner Error 0.002019
/deprop Inner Error 0.000460
/deprop Inner Error 0.000080
/deprop Inner Error 0.000005
Inner loop converged
/deprop Iteration 1 Outer Error 0.011370
/deprop Inner Error 0.004427
/deprop Inner Error 0.001464
/deprop Inner Error 0.000367
/deprop Inner Error 0.000014
/deprop Inner Error 0.000001
Inner loop converged
/deprop Iteration 2 Outer Error 0.001682
/deprop Inner Error 0.000202
/deprop Inner Error 0.000008
Inner loop converged
/deprop Iteration 3 Outer Error 0.000284
/deprop Inner Error 0.000016
/deprop Inner Error 0.000000
Inner loop converged
/deprop Iteration 4 Outer Error 0.000061
/deprop Inner Error 0.000001
Inner loop converged
>> deprop.Stage_19.c.c3spec.Port = None
>> deprop.TriggerSolve = 1
>> deprop.Stage_19.c.c3spec.Port = 0.02
>> deprop.TryToSolve = 1
/deprop Inner Error 0.004459
/deprop Inner Error 0.000821
/deprop Inner Error 0.000058
/deprop Inner Error 0.000001
Inner loop converged
/deprop Iteration 1 Outer Error 0.014875
/deprop Inner Error 0.003521
/deprop Inner Error 0.000622
/deprop Inner Error 0.000015
/deprop Inner Error 0.000003
Inner loop converged
/deprop Iteration 2 Outer Error 0.001601
/deprop Inner Error 0.000232
/deprop Inner Error 0.000017
/deprop Inner Error 0.000001
Inner loop converged
/deprop Iteration 3 Outer Error 0.000270
/deprop Inner Error 0.000009
Inner loop converged
/deprop Iteration 4 Outer Error 0.000056
/deprop Inner Error 0.000001
Inner loop converged
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>> 
