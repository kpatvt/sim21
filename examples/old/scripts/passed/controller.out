>> # hysim 1.5 tutorial problem
>> units Field
>> $thermo = Sim21Thermo.Peng-Robinson
pkgName: Peng-Robinson
>> / -> $thermo
Thermo case attached to a unit operation. / to /thermo
>> thermo + Methane Ethane Propane
Methane Ethane Propane 
>> thermo + isoButane n-Butane isoPentane n-Pentane n-Hexane
isoButane n-Butane isoPentane n-Pentane n-Hexane 
>> thermo + n-Heptane n-Octane
n-Heptane n-Octane 
>> 
>> Feed = Sensor.PropertySensor()
>> Feed.SignalType = T
>> Feed.In.T = 60
>> Feed.In.P = 600
>> Feed.In.MoleFlow = 144
>> Feed.In.Fraction = 70 20 10 9 8 7 6 5 4 3
>> 
>> # Inlet separator
>> Sep = Flash.SimpleFlash()
>> Feed.Out -> Sep.In
>> 
>> Gas-Gas = Heater.HeatExchanger()
>> cd Gas-Gas
/Gas-Gas
>> DeltaPH = 10
>> DeltaPC = 10
>> DeltaTHI = 10
>> cd ..
/
>> 
>> Sep.Vap -> Gas-Gas.InH
>> 
>> Chiller = Heater.HeatExchanger()
>> cd Chiller
/Chiller
>> DeltaPH = 10
>> DeltaPC = .1
>> DeltaTCI = 5  # 5 degree approach on the hot end
>> cd ..
/
>> 
>> Gas-Gas.OutH -> Chiller.InH
>> 
>> LTS = Flash.SimpleFlash()
>> 
>> LTS-Feed = Sensor.PropertySensor()
>> LTS-Feed.SignalType = T
>> LTS-Feed.In.T = 0
>> 
>> Chiller.OutH -> LTS-Feed.In
>> LTS-Feed.Out -> LTS.In
>> 
>> LTS.Vap -> Gas-Gas.InC
>> 
>> # dew point check - use mole balance to copy material of the sales gas
>> DP = Balance.BalanceOp()
>> cd DP
/DP
>> NumberStreamsInMat = 1
>> NumberStreamsOutMat = 1
>> BalanceType = 2 # Mole balance
>> cd ..
/
>> 
>> Gas-Gas.OutC -> DP.In0
>> DP.Out0.P = 815
>> DP.Out0.VapFrac = 1.
>> DewPoint = Sensor.PropertySensor()
>> DewPoint.SignalType = T
>> DP.Out0 -> DewPoint.In
>> 
>> # mix flash liquid streams
>> Mixer = Mixer.Mixer()
>> Sep.Liq0 -> Mixer.In0
>> LTS.Liq0 -> Mixer.In1
>> 
>> Tower_Feed = Sensor.PropertySensor()
>> Tower_Feed.SignalType = T
>> Mixer.Out -> Tower_Feed.In
>> 
>> Mixer.Out
Port: /Mixer.Out + sim21.old.solver.Ports.Port_Material
Connected to: /Tower_Feed.In
VapFrac            = 0.014500871146056138 = 
T                  = 56.223271186780025 = F
P                  = 580.0 = psia
MoleFlow           = 78.67816287749834 = lbmole/h
MassFlow           = 4092.1608111267715 = lb/h
VolumeFlow         = 0.034166563175150225 = ft3/s
StdLiqVolumeFlow   = 0.0300013045088856 = ft3/s
H                  = -60266.93593106006 = Btu/lbmol
Energy             = -4740894.433753197 = Btu/hr
MolecularWeight    = 52.01139250668898 = 
ZFactor            = 0.16377641232476056 = 
METHANE            = 0.2084358216237413 = 
ETHANE             = 0.15292416695685274 = 
PROPANE            = 0.10890649288665483 = 
ISOBUTANE          = 0.1093944168106001 = 
N-BUTANE           = 0.0994315170133183 = 
ISOPENTANE         = 0.08940392442391329 = 
N-PENTANE          = 0.07689228970299297 = 
N-HEXANE           = 0.06439387339343319 = 
N-HEPTANE          = 0.05155094294206458 = 
N-OCTANE           = 0.038666554246428606 = 

>> DewPoint.Out
Port: /DewPoint.Out + sim21.old.solver.Ports.Port_Material
Connected to: None
VapFrac            = 1.0 = 
T                  = 1.2347813320039733 = F
P                  = 815.0000000000001 = psia
MoleFlow           = 65.32183712250168 = lbmole/h
MassFlow           = 1247.6948914084398 = lb/h
VolumeFlow         = 0.07715422316680956 = ft3/s
StdLiqVolumeFlow   = 0.011274889443303487 = ft3/s
H                  = -34823.30354255745 = Btu/lbmol
Energy             = -2274339.642557574 = Btu/hr
MolecularWeight    = 19.100731797676904 = 
ZFactor            = 0.7006221291814198 = 
METHANE            = 0.8356557374124463 = 
ETHANE             = 0.12629616661938903 = 
PROPANE            = 0.024069780550118384 = 
ISOBUTANE          = 0.00795765769251283 = 
N-BUTANE           = 0.00443323363769371 = 
ISOPENTANE         = 0.0009867300802133946 = 
N-PENTANE          = 0.0005321795973444474 = 
N-HEXANE           = 6.170794067175263e-05 = 
N-HEPTANE          = 6.193072676063246e-06 = 
N-OCTANE           = 6.133969341714794e-07 = 

>> LTS-Feed.In.T
/LTS-Feed.In.T= 0.0 * F
>> Feed.In.T
/Feed.In.T= 60.00000000000003 * F
>> 
>> hold  # keep things in limbo while controllers are set up
>> 
>> #remove previous fixed values
>> LTS-Feed.In.T = None
>> Feed.In.T = None
>> 
>> DPControl = Controller.Controller()
>> DPControl.In -> DewPoint.Signal
>> DPControl.Out -> LTS-Feed.Signal
ControllerConnect ('/DPControl.Out', '/LTS-Feed.Signal')
ControllerConnect ('/DPControl.Out', '/LTS-Feed.Signal')
ControllerConnect ('/DPControl.Out', '/LTS-Feed.Signal')
>> DPControl.Out = 0
>> DPControl.Target = 15
>> DPControl.StepSize = 10
>> 
>> TLiqCont = Controller.Controller()
>> TLiqCont.In -> Tower_Feed.Signal
>> TLiqCont.Out -> Feed.Signal
ControllerConnect ('/TLiqCont.Out', '/Feed.Signal')
ControllerConnect ('/TLiqCont.Out', '/Feed.Signal')
ControllerConnect ('/TLiqCont.Out', '/Feed.Signal')
>> TLiqCont.Out = 60
>> TLiqCont.Target = 50
>> TLiqCont.StepSize = 10
>> 
>> go
Controller solver for / calculating derivative 0
Controller solver for / calculating derivative 1
Controller solver for / error - 0.025647
Controller solver for / error - 0.001221
Controller solver for / error - 0.000067
>> 
>> copy /
Copied / to the clipboard
>> paste /
Pasting /
Pasted / as /RootClone
>> 
>> Mixer.Out.T
/Mixer.Out.T= 50.01014283521512 = F
>> DewPoint.Out.T
/DewPoint.Out.T= 15.001892177114682 = F
>> LTS-Feed.In.T
/LTS-Feed.In.T= 13.55173943252897 = F
>> Feed.In.T
/Feed.In.T= 51.59096738772522 = F
>> Tower_Feed.In.T
/Tower_Feed.In.T= 50.01014283521512 | F
>> 
>> cd /RootClone
/RootClone
>> Mixer.Out.T
/RootClone.Mixer.Out.T= 50.01014283521512 = F
>> DewPoint.Out.T
/RootClone.DewPoint.Out.T= 15.001892177114682 = F
>> LTS-Feed.In.T
/RootClone.LTS-Feed.In.T= 13.55173943252897 = F
>> Feed.In.T
/RootClone.Feed.In.T= 51.59096738772522 = F
>> Tower_Feed.In.T
/RootClone.Tower_Feed.In.T= 50.01014283521512 | F
>> 
>> cd /
/
>> 
>> # now let's make it fail
>> TLiqCont.Minimum = 53
>> TLiqCont.Out = 60
Controller solver for / error - 0.007520
Controller solver for / error - 0.007520
Controller solver for / calculating derivative 0
Controller solver for / calculating derivative 1
Controller solver for / error - 0.007578
Controller solver for / failed to converge
>> hold  # so it doesn't try and solve on each command
>> 
>> Feed.In.T
/Feed.In.T= 53.00000000000001 = F
>> DewPoint.In.T
/DewPoint.In.T= 14.945744568214517 | F
>> Tower_Feed.In.T
/Tower_Feed.In.T= 51.30985149970235 | F
>> 
>> #Make sure disconnecting doesn't screw things up
>> #TLiqCont.In ->
>> #Tower_Feed.Signal =  10.0
