>> # hysim 1.5 tutorial problem
>> units Field
>> $thermo = Sim21Thermo.Peng-Robinson
pkgName: Peng-Robinson
>> / -> $thermo
Thermo case attached to a unit operation. / to /thermo
>> thermo + Methane Ethane Propane
Methane Ethane Propane 
>> thermo + isoButane n-Butane isoPentane n-Pentane n-Hexane
isoButane n-Butane isoPentane n-Pentane n-Hexane 
>> thermo + n-Heptane n-Octane
n-Heptane n-Octane 
>> 
>> Feed = Stream.Stream_Material()
>> Feed.In.T = 60
>> Feed.In.P = 600
>> Feed.In.MoleFlow = 144
>> Feed.In.Fraction = 70 20 10 9 8 7 6 7 4 3
>> 
>> # Inlet separator
>> Sep = Flash.SimpleFlash()
>> Feed.Out -> Sep.In
>> 
>> Gas-Gas = Heater.HeatExchanger()
>> cd Gas-Gas
/Gas-Gas
>> DeltaPH = 10
>> DeltaPC = 10
>> DeltaTHI = 10
>> cd ..
/
>> 
>> Sep.Vap -> Gas-Gas.InH
>> 
>> Chiller = Heater.HeatExchanger()
>> cd Chiller
/Chiller
>> DeltaPH = 10
>> DeltaPC = .1
>> DeltaTCI = 5  # 5 degree approach on the hot end
>> cd ..
/
>> 
>> Gas-Gas.OutH -> Chiller.InH
>> 
>> # create a nested Flowsheet for the LTS and dewpoint calc
>> # this prevents the controller solver from resolving everything during
>> # its iterations
>> 
>> ContFS = Flowsheet.Flowsheet()
>> cd ContFS
/ContFS
>> 
>> LTS = Flash.SimpleFlash()
>> 
>> #LTS-Feed = Sensor.PropertySensor()
>> #LTS-Feed.SignalType = T
>> LTS-Feed = Stream.Stream_Material()
>> LTS-Feed.Signal = Stream.SensorPort('T')
>> 
>> LTS-Vap = Stream.Stream_Material()
>> LTS-Vap.DPFeed = Stream.ClonePort(0)   # outgoing clone for dew point
>> 
>> /Chiller.OutH -> LTS-Feed.In
>> LTS-Feed.Out -> LTS.In
>> 
>> LTS.Vap -> LTS-Vap.In
>> LTS-Vap.Out -> /Gas-Gas.InC
>> 
>> # dew point check - use mole balance to copy material of the sales gas
>> DP = Balance.BalanceOp()
>> cd DP
/ContFS.DP
>> NumberStreamsInMat = 1
>> NumberStreamsOutMat = 1
>> BalanceType = 2 # Mole balance
>> cd ..
/ContFS
>> 
>> LTS-Vap.DPFeed -> DP.In0
>> DP.Out0.P = 815
>> DP.Out0.VapFrac = 1.
>> DewPoint = Sensor.PropertySensor()
>> DewPoint.SignalType = T
>> DP.Out0 -> DewPoint.In
>> 
>> DPControl = Controller.Controller()
>> DPControl.In -> DewPoint.Signal
>> DPControl.Out -> LTS-Feed.Signal
ControllerConnect ('/ContFS.DPControl.Out', '/ContFS.LTS-Feed.Signal')
ControllerConnect ('/ContFS.DPControl.Out', '/ContFS.LTS-Feed.Signal')
ControllerConnect ('/ContFS.DPControl.Out', '/ContFS.LTS-Feed.Signal')
>> DPControl.Out = 0
>> DPControl.Target = 15
>> DPControl.StepSize = 10
Controller solver for /ContFS calculating derivative 0
Controller solver for /ContFS error - 0.020169
Controller solver for /ContFS error - 0.000091
>> 
>> # return to root flowsheet
>> cd /
/
>> 
>> # mix flash liquid streams
>> Mixer = Mixer.Mixer()
>> Sep.Liq0 -> Mixer.In0
>> ContFS.LTS.Liq0 -> Mixer.In1
>> 
>> deprop = Tower.Tower()
>> deprop.Stage_0 + 10  # twelve stages`
>> 
>> cd deprop.Stage_0
/deprop.Stage_0
>> v = Tower.VapourDraw()
>> v.Port.P = 200
>> reflux = Tower.RefluxRatioSpec()
>> reflux.Port = 1.0
>> 
>> cond = Tower.EnergyFeed(0)
>> estT = Tower.Estimate('T')
>> estT.Value = 40
>> 
>> cd ../Stage_5
/deprop.Stage_5
>> f = Tower.Feed()
>> /Mixer.Out -> f.Port
>> 
>> cd ../Stage_11
/deprop.Stage_11
>> l = Tower.LiquidDraw()
>> l.Port.P = 205
>> l.Port.Fraction.PROPANE = .02
>> 
>> reb = Tower.EnergyFeed(1)
>> estT = Tower.Estimate('T')
>> estT.Value = 200
>> 
>> cd ..
/deprop
>> 
>> /overhead = Stream.Stream_Material()
>> /overhead.In -> Stage_0.v.Port
>> 
>> /bottoms = Stream.Stream_Material()
>> /bottoms.In -> Stage_11.l.Port
>> 
>> 
>> 
>> TryToSolve = 1  # start calculation
Calculating Jacobian for /deprop
Calculating disturbance 10 of 12 in jacobian of /deprop
/deprop Inner Error 0.009569
/deprop Inner Error 0.006870
/deprop Inner Error 0.001180
/deprop Inner Error 0.000140
/deprop Inner Error 0.000006
Inner loop converged
/deprop Iteration 1 Outer Error 0.076544
/deprop Inner Error 0.026464
/deprop Inner Error 0.021464
/deprop Inner Error 0.006670
/deprop Inner Error 0.000600
/deprop Inner Error 0.000005
Inner loop converged
/deprop Iteration 2 Outer Error 0.012083
/deprop Inner Error 0.001629
/deprop Inner Error 0.000987
/deprop Inner Error 0.000156
/deprop Inner Error 0.000012
/deprop Inner Error 0.000000
Inner loop converged
/deprop Iteration 3 Outer Error 0.001827
/deprop Inner Error 0.000609
/deprop Inner Error 0.000015
/deprop Inner Error 0.000001
Inner loop converged
/deprop Iteration 4 Outer Error 0.000395
/deprop Inner Error 0.000106
/deprop Inner Error 0.000006
Inner loop converged
/deprop Iteration 5 Outer Error 0.000081
/deprop Inner Error 0.000002
Inner loop converged
>> 
>> /overhead.Out
Port: /overhead.Out + sim21.old.solver.Ports.Port_Material
Connected to: None
VapFrac            = 1.0 = 
T                  = 16.421345799534823 = F
P                  = 200.0 = psia
MoleFlow           = 35.583907740917496 = lbmole/h
MassFlow           = 954.1022643073685 = lb/h
VolumeFlow         = 0.21920862429195298 = ft3/s
StdLiqVolumeFlow   = 0.007561027723317187 = ft3/s
H                  = -37309.46134738953 = Btu/lbmol
Energy             = -1327393.1771636938 = Btu/hr
MolecularWeight    = 26.812745437646537 = 
ZFactor            = 0.8681201702724951 = 
METHANE            = 0.4565463931140254 = 
ETHANE             = 0.3275263508138024 = 
PROPANE            = 0.2074644464023474 = 
ISOBUTANE          = 0.007553934389176059 = 
N-BUTANE           = 0.0009042532950217614 = 
ISOPENTANE         = 3.8735700496969715e-06 = 
N-PENTANE          = 7.471041944555458e-07 = 
N-HEXANE           = 8.452953568751482e-10 = 
N-HEPTANE          = 2.2663524538441598e-10 = 
N-OCTANE           = 2.3945221033693967e-10 = 

>> /bottoms.Out
Port: /bottoms.Out + sim21.old.solver.Ports.Port_Material
Connected to: None
VapFrac            = 0.0 = 
T                  = 260.33665444872565 = F
P                  = 205.0 = psia
MoleFlow           = 43.344646901248765 = lbmole/h
MassFlow           = 3219.774939054452 = lb/h
VolumeFlow         = 0.02881058784336054 = ft3/s
StdLiqVolumeFlow   = 0.022944196206908955 = ft3/s
H                  = -68624.17566895425 = Btu/lbmol
Energy             = -2973990.4699836513 = Btu/hr
MolecularWeight    = 74.28310458705546 = 
ZFactor            = 0.06348485469176607 = 
METHANE            = 1.0200507841656397e-07 = 
ETHANE             = 9.888121632582512e-05 = 
PROPANE            = 0.02 = 
ISOBUTANE          = 0.18617335408726984 = 
N-BUTANE           = 0.17477776436357084 = 
ISOPENTANE         = 0.15913154839984311 = 
N-PENTANE          = 0.1370924914408617 = 
N-HEXANE           = 0.16124956078375496 = 
N-HEPTANE          = 0.09226444814852161 = 
N-OCTANE           = 0.06921070220763371 = 

>> 
>> 
>> # add refrigeration
>> # fix the chiller cold outlet as boiling refrigerant
>> cd /Chiller.OutC
/Chiller.ColdSide.Out
>> VapFrac = 1
>> Fraction = 0 0 1 0 0 0 0 0 0 0
>> cd /
/
>> Chiller.DeltaTHI = 30
>> 
>> # add valve
>> V-100 = Valve.Valve()
>> V-100.Out -> Chiller.InC
>> 
>> # add condensor
>> E-103 = Heater.Cooler()
>> E-103.Out -> V-100.In
>> 
>> # Condensor outlet is bubble point liquid at air cooler kind of T
>> E-103.Out.T = 120
>> E-103.Out.VapFrac = 0
>> E-103.DeltaP = 5
>> 
>> V-100.Out
Port: /V-100.Out + sim21.old.solver.Ports.Port_Material
Connected to: /Chiller.ColdSide.In
VapFrac            = 0.44659587363921827 = 
T                  = 2.892472294345076 = F
P                  = 40.572734439858316 | psia
MoleFlow           = 5.412333354374069 | lbmole/h
MassFlow           = 238.66019490780428 | lb/h
VolumeFlow         = 0.07723002767131046 | ft3/s
StdLiqVolumeFlow   = 0.0018030739972871238 | ft3/s
H                  = -50589.25546444542 = Btu/lbmol
Energy             = -273759.87125116005 | Btu/hr
MolecularWeight    = 44.09562 = 
ZFactor            = 0.4198572705416037 = 
METHANE            = 0.0 | 
ETHANE             = 0.0 | 
PROPANE            = 1.0 | 
ISOBUTANE          = 0.0 | 
N-BUTANE           = 0.0 | 
ISOPENTANE         = 0.0 | 
N-PENTANE          = 0.0 | 
N-HEXANE           = 0.0 | 
N-HEPTANE          = 0.0 | 
N-OCTANE           = 0.0 | 

>> 
>> # compressor isn't needed to calculate flows, but add it for completeness
>> K-100 = Compressor.Compressor()
>> K-100.Efficiency = .75
>> 
>> Chiller.OutC -> K-100.In
>> 
>> K-100.Out -> E-103.In
>> K-100.Out
Port: /K-100.Waste.Out + sim21.old.solver.Ports.Port_Material
Connected to: /E-103.In
VapFrac            = 1.0 = 
T                  = 142.36857790730184 = F
P                  = 248.42072802025643 | psia
MoleFlow           = 5.41233335437407 = lbmole/h
MassFlow           = 238.6601949078043 = lb/h
VolumeFlow         = 0.02967251066226592 = ft3/s
StdLiqVolumeFlow   = 0.0018030739972871245 = ft3/s
H                  = -44654.780702996 = Btu/lbmol
Energy             = -241645.91678153066 = Btu/hr
MolecularWeight    = 44.09562 = 
ZFactor            = 0.7588735212138864 = 
METHANE            = 0.0 = 
ETHANE             = 0.0 = 
PROPANE            = 1.0 = 
ISOBUTANE          = 0.0 = 
N-BUTANE           = 0.0 = 
ISOPENTANE         = 0.0 = 
N-PENTANE          = 0.0 = 
N-HEXANE           = 0.0 = 
N-HEPTANE          = 0.0 = 
N-OCTANE           = 0.0 = 

>> E-103.OutQ
Port: /E-103.OutQ + sim21.old.solver.Ports.Port_Energy
Connected to: None
Energy   = 32113.954469629403 = Btu/hr

>> 
>> 
>> # try making some changes
>> cd /
/
>> Feed.In.T = 55
Controller solver for /ContFS error - 0.000011
/deprop Inner Error 0.000704
/deprop Inner Error 0.000064
/deprop Inner Error 0.000057
Inner loop is not changing significantly - exiting
/deprop Iteration 1 Outer Error 0.002717
Calculating Jacobian for /deprop
Calculating disturbance 10 of 12 in jacobian of /deprop
/deprop Inner Error 0.000104
/deprop Inner Error 0.000001
Inner loop converged
/deprop Iteration 2 Outer Error 0.000360
/deprop Inner Error 0.000011
/deprop Inner Error 0.000000
Inner loop converged
/deprop Iteration 3 Outer Error 0.000073
/deprop Inner Error 0.000002
Inner loop converged
>> bottoms.Out
Port: /bottoms.Out + sim21.old.solver.Ports.Port_Material
Connected to: None
VapFrac            = 3.6952663756135144e-08 = 
T                  = 260.2382204196692 = F
P                  = 205.0 = psia
MoleFlow           = 43.37965154987899 = lbmole/h
MassFlow           = 3221.72832297443 = lb/h
VolumeFlow         = 0.02882695411660124 = ft3/s
StdLiqVolumeFlow   = 0.0229599815462285 = ft3/s
H                  = -68620.24372648346 = Btu/lbmol
Energy             = -2976221.6935783243 = Btu/hr
MolecularWeight    = 74.26819275553672 = 
ZFactor            = 0.0634783390966033 = 
METHANE            = 9.868889989752994e-08 = 
ETHANE             = 9.620388499217072e-05 = 
PROPANE            = 0.02 = 
ISOBUTANE          = 0.18676170853523127 = 
N-BUTANE           = 0.1747983331627022 = 
ISOPENTANE         = 0.15895196838369305 = 
N-PENTANE          = 0.13694167131486723 = 
N-HEXANE           = 0.16110630288554895 = 
N-HEPTANE          = 0.09218895503143419 = 
N-OCTANE           = 0.06915476401128431 = 

>> ContFS.DewPoint.In.T
/ContFS.DewPoint.In.T= 14.997993802160734 | F
>> 
>> ContFS.DPControl.Target = 10
Controller solver for /ContFS error - 0.000240
Controller solver for /ContFS error - 0.000001
/deprop Inner Error 0.000068
/deprop Inner Error 0.000007
Inner loop converged
/deprop Iteration 1 Outer Error 0.000137
/deprop Inner Error 0.000027
/deprop Inner Error 0.000003
Inner loop converged
/deprop Iteration 2 Outer Error 0.000040
/deprop Inner Error 0.000004
Inner loop converged
>> ContFS.DewPoint.In.T
/ContFS.DewPoint.In.T= 9.99989445181803 | F
>> bottoms.Out
Port: /bottoms.Out + sim21.old.solver.Ports.Port_Material
Connected to: None
VapFrac            = 7.709518289102535e-08 = 
T                  = 260.04424758786826 = F
P                  = 205.0 = psia
MoleFlow           = 43.503843340816225 = lbmole/h
MassFlow           = 3229.372259428071 = lb/h
VolumeFlow         = 0.028894421702253332 = ft3/s
StdLiqVolumeFlow   = 0.0230183856784514 = ft3/s
H                  = -68606.72073945207 = Btu/lbmol
Energy             = -2984154.1284815427 = Btu/hr
MolecularWeight    = 74.2318841608692 = 
ZFactor            = 0.06346236760150606 = 
METHANE            = 9.804662421350465e-08 = 
ETHANE             = 9.592888255616191e-05 = 
PROPANE            = 0.02 = 
ISOBUTANE          = 0.18742056179625968 = 
N-BUTANE           = 0.17522024212577406 = 
ISOPENTANE         = 0.15887983222935798 = 
N-PENTANE          = 0.13679014207405502 = 
N-HEXANE           = 0.16070443761862793 = 
N-HEPTANE          = 0.09193086507715971 = 
N-OCTANE           = 0.06895790577474643 = 

>> 
>> 
>> 
>> copy /
Copied / to the clipboard
>> paste /
Pasting /
Pasted / as /RootClone
/RootClone.deprop Inner Error 0.000000
Inner loop converged
/RootClone.deprop Iteration 1 Outer Error 0.000005
/RootClone.deprop Inner Error 0.000000
Inner loop converged
>> cd /RootClone
/RootClone
>> ContFS.DewPoint.In.T
/RootClone.ContFS.DewPoint.In.T= 9.99989445181803 | F
>> bottoms.Out
Port: /RootClone.bottoms.Out + sim21.old.solver.Ports.Port_Material
Connected to: None
VapFrac            = 0.0 = 
T                  = 260.0442042218885 = F
P                  = 205.0 = psia
MoleFlow           = 43.50386024945305 = lbmole/h
MassFlow           = 3229.3732544400445 = lb/h
VolumeFlow         = 0.028894405238151386 = ft3/s
StdLiqVolumeFlow   = 0.023018393540391823 = ft3/s
H                  = -68606.71995700775 = Btu/lbmol
Energy             = -2984155.2542989682 = Btu/hr
MolecularWeight    = 74.23187818098616 = 
ZFactor            = 0.0634623105985106 = 
METHANE            = 9.804040342116622e-08 = 
ETHANE             = 9.592546117369312e-05 = 
PROPANE            = 0.02 = 
ISOBUTANE          = 0.18742080800826513 = 
N-BUTANE           = 0.17522022088714845 = 
ISOPENTANE         = 0.15887977070546683 = 
N-PENTANE          = 0.1367900889510898 = 
N-HEXANE           = 0.16070437515770308 = 
N-HEPTANE          = 0.09193082934642983 = 
N-OCTANE           = 0.06895787897291643 = 

>> # Feed.In.T = 55
>> # bottoms.Out
>> # ContFS.DewPoint.In.T
>> cd /
/
>> 
>> 
>> 
