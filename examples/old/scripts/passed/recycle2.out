>> # A recycle test with information flowing both ways
>> # through the recycle
>> 
>> units SI
>> # set up thermo
>> $thermo = Sim21Thermo.Peng-Robinson
pkgName: Peng-Robinson
>> / -> $thermo
Thermo case attached to a unit operation. / to /thermo
>> thermo + PROPANE n-BUTANE ISOBUTANE n-NONANE
PROPANE n-BUTANE ISOBUTANE n-NONANE 
>> 
>> # Add a stream
>> stream = Stream.Stream_Material()
>> 
>> # Make the stream In port current to save typing
>> cd stream.In
/stream.In
>> Fraction = .25 .25 .25 .25
>> T = 360.15 K
>> P = 715
>> # Note that flow is not known for the feed stream
>> 
>> # Now create a recycle stream
>> cd /
/
>> recycle = Stream.Stream_Material()
>> 
>> # add a mixer to combine the first stream with the recycle
>> cd /
/
>> mixer = Mixer.Mixer()
>> stream.Out -> mixer.In0
>> recycle.Out -> mixer.In1
>> recycle.Out -> mixer.In1
>> mixer.Out
Port: /mixer.Out + sim21.old.solver.Ports.Port_Material
Connected to: None
VapFrac            = None
T                  = None
P                  = None
MoleFlow           = None
MassFlow           = None
VolumeFlow         = None
StdLiqVolumeFlow is invalid
H                  = None
Energy             = None
MolecularWeight    = None
ZFactor            = None
PROPANE            = None
N-BUTANE           = None
ISOBUTANE          = None
N-NONANE           = None

>> 
>> # add a separator
>> flash = Flash.SimpleFlash()
>> mixer.Out -> flash.In
>> 
>> # instead of estimating the recycle stream, I will estimate
>> # the inlet port of the flash for everything but flow
>> # I will just use the same values as the feed stream
>> cd flash.In
/flash.In
>> # Note use of ~= to mean estimate
>> Fraction ~= .25 .25 .25 .25
Changed state of port /flash.In to 1 (0=Normal port; 1=Recycle port)
>> T ~= 360.15 K
>> cd /
/
>> 
>> # fix the flow of the vapour from the flash
>> flash.Vap.MoleFlow = 1652.682
>> 
>> # split the liquid from the flash
>> splitter = Split.Splitter()
>> flash.Liq0 -> splitter.In
>> 
>> # set the flow in one of the splitter outlets
>> splitter.Out1.MoleFlow = 200
>> splitter.Out1.P = 715
>> 
>> # close the recycle
>> splitter.Out1 -> recycle.In
>> 
>> # still needs balance to figure out flow
>> balance = Balance.BalanceOp()
>> # just need a mole balance
>> balance.BalanceType = 2
>> 
>> #set number of balance streams
>> balance.NumberStreamsInMat = 2
>> balance.NumberStreamsOutMat = 1
>> 
>> # connect the dangling ends of the streams to the balance
>> stream.In -> balance.Out0
>> flash.Vap -> balance.In1
>> splitter.Out0 -> balance.In0
Iteration 1 -> max Error 1.082683 in /balance.In0.MoleFlow
Iteration 2 -> max Error 1.369606 in /balance.In0.MoleFlow
Iteration 3 -> max Error 1.342367 in /balance.In0.MoleFlow
Iteration 4 -> max Error 0.000000 in /flash.In.Fraction.N-NONANE
>> 
>> # All done - check some streams
>> recycle.Out
Port: /recycle.Out + sim21.old.solver.Ports.Port_Material
Connected to: /mixer.In1
VapFrac            = 0.0 = 
T                  = 86.99958015877422 = C
P                  = 715.0 = kPa
MoleFlow           = 200.0 = kgmole/h
MassFlow           = 18891.410547648407 = kg/h
VolumeFlow         = 31.527480807611845 = m3/hr
StdLiqVolumeFlow   = 28.234518765315226 = m3/hr
H                  = -200543.6543743605 = kJ/kmol
Energy             = -11141314.131908918 = W
MolecularWeight    = 94.45705273824204 = 
ZFactor            = 0.03763987896350268 = 
PROPANE            = 0.101680990982413 = 
N-BUTANE           = 0.19421126784248838 = 
ISOBUTANE          = 0.16568584085818416 = 
N-NONANE           = 0.5384219003169145 = 

>> splitter.Liq0
None
>> splitter.Liq0.Out
There is no object named Out
Error processing command:
<class 'sim21.old.cli.CommandInterface.CmdError'>
There is no object named Out
  File "/home/theadmin/Projects/sim21/sim21/old/cli/CommandInterface.py", line 3562, in run
    interface.ProcessCommandStream(inp, out, err)

  File "/home/theadmin/Projects/sim21/sim21/old/cli/CommandInterface.py", line 284, in ProcessCommandStream
    cmdResult = self.ProcessCommandString(cmd)

  File "/home/theadmin/Projects/sim21/sim21/old/cli/CommandInterface.py", line 379, in ProcessCommandString
    cmdResult = self.ProcessCommand(cmd)

  File "/home/theadmin/Projects/sim21/sim21/old/cli/CommandInterface.py", line 342, in ProcessCommand
    lhsObj = self.GetObject(self.currentObj, lhsDesc)

  File "/home/theadmin/Projects/sim21/sim21/old/cli/CommandInterface.py", line 2175, in GetObject
    return self.GetObject(obj, remaining)

  File "/home/theadmin/Projects/sim21/sim21/old/cli/CommandInterface.py", line 2180, in GetObject
    raise CmdError('CMDNoSuchName', remaining)


>> splitter.Out0
Port: /splitter.Out0 + sim21.old.solver.Ports.Port_Material
Connected to: /balance.In0
VapFrac            = 0.0 = 
T                  = 86.99958015877422 = C
P                  = 715.0 = kPa
MoleFlow           = 1344.5359135076753 = kgmole/h
MassFlow           = 127000.89969065494 = kg/h
VolumeFlow         = 211.94915104129046 = m3/hr
StdLiqVolumeFlow   = 189.81162240286355 = m3/hr
H                  = -200543.6543743605 = kJ/kmol
Energy             = -74899484.87011065 = W
MolecularWeight    = 94.45705273824204 = 
ZFactor            = 0.03763987896350268 = 
PROPANE            = 0.101680990982413 = 
N-BUTANE           = 0.19421126784248838 = 
ISOBUTANE          = 0.16568584085818416 = 
N-NONANE           = 0.5384219003169145 = 

>> flash.In
Port: /flash.In + sim21.old.solver.Ports.Port_Material
Connected to: /mixer.Out
VapFrac            = 0.5169125298021487 = 
T                  = 86.99958015877422 ~ C
P                  = 715.0 = kPa
MoleFlow           = 3197.2179135076753 = kgmole/h
MassFlow           = 235136.9700857399 = kg/h
VolumeFlow         = 6438.340562465776 = m3/hr
StdLiqVolumeFlow   = 372.4724227239262 = m3/hr
H                  = -157518.13245364197 = kJ/kmol
Energy             = -139894387.43973857 = W
MolecularWeight    = 73.54424266557751 = 
ZFactor            = 0.4808289983819298 = 
PROPANE            = 0.24072211300272817 ~ 
N-BUTANE           = 0.2465102139592245 ~ 
ISOBUTANE          = 0.24472584614397452 ~ 
N-NONANE           = 0.2680418268940728 ~ 

>> stream.Out
Port: /stream.Out + sim21.old.solver.Ports.Port_Material
Connected to: /mixer.In0
VapFrac            = 0.551407770688256 = 
T                  = 87.0 = C
P                  = 715.0 = kPa
MoleFlow           = 2997.2171329590255 = kgmole/h
MassFlow           = 216245.55953809147 = kg/h
VolumeFlow         = 6406.846929297581 = m3/hr
StdLiqVolumeFlow   = 344.23788076317646 = m3/hr
H                  = -154647.01913427297 = kJ/kmol
Energy             = -128752970.91952367 = W
MolecularWeight    = 72.14878 = 
ZFactor            = 0.5104045993111413 = 
PROPANE            = 0.25 = 
N-BUTANE           = 0.25 = 
ISOBUTANE          = 0.25 = 
N-NONANE           = 0.25 = 

>> 
>> # reset the temperature
>> stream.In.T = 400 K
Iteration 1 -> max Error 0.880605 in /flash.In.Energy
Iteration 2 -> max Error 0.653850 in /balance.In0.Fraction.N-NONANE
Iteration 3 -> max Error 0.735746 in /balance.In0.Fraction.N-NONANE
Iteration 4 -> max Error 0.740677 in /balance.In0.Fraction.N-NONANE
Iteration 5 -> max Error 0.000003 in /flash.In.Fraction.N-NONANE
>> 
>> # check streams again
>> recycle.Out
Port: /recycle.Out + sim21.old.solver.Ports.Port_Material
Connected to: /mixer.In1
VapFrac            = 0.0 = 
T                  = 126.84989168459111 = C
P                  = 715.0 = kPa
MoleFlow           = 200.0 = kgmole/h
MassFlow           = 21862.025276283246 = kg/h
VolumeFlow         = 37.402032625857615 = m3/hr
StdLiqVolumeFlow   = 31.62195231985825 = m3/hr
H                  = -213999.65787397354 = kJ/kmol
Energy             = -11888869.88188742 = W
MolecularWeight    = 109.31012638141624 = 
ZFactor            = 0.04020473390344537 = 
PROPANE            = 0.05629071461962695 = 
N-BUTANE           = 0.11001241035215306 = 
ISOBUTANE          = 0.09256835199144821 = 
N-NONANE           = 0.7411285230367718 = 

>> splitter.Liq0
None
>> splitter.Liq0.Out
There is no object named Out
Error processing command:
<class 'sim21.old.cli.CommandInterface.CmdError'>
There is no object named Out
  File "/home/theadmin/Projects/sim21/sim21/old/cli/CommandInterface.py", line 3562, in run
    interface.ProcessCommandStream(inp, out, err)

  File "/home/theadmin/Projects/sim21/sim21/old/cli/CommandInterface.py", line 284, in ProcessCommandStream
    cmdResult = self.ProcessCommandString(cmd)

  File "/home/theadmin/Projects/sim21/sim21/old/cli/CommandInterface.py", line 379, in ProcessCommandString
    cmdResult = self.ProcessCommand(cmd)

  File "/home/theadmin/Projects/sim21/sim21/old/cli/CommandInterface.py", line 342, in ProcessCommand
    lhsObj = self.GetObject(self.currentObj, lhsDesc)

  File "/home/theadmin/Projects/sim21/sim21/old/cli/CommandInterface.py", line 2175, in GetObject
    return self.GetObject(obj, remaining)

  File "/home/theadmin/Projects/sim21/sim21/old/cli/CommandInterface.py", line 2180, in GetObject
    raise CmdError('CMDNoSuchName', remaining)


>> splitter.Out0
Port: /splitter.Out0 + sim21.old.solver.Ports.Port_Material
Connected to: /balance.In0
VapFrac            = 0.0 = 
T                  = 126.84989168459111 = C
P                  = 715.0 = kPa
MoleFlow           = 593.0758713220511 = kgmole/h
MassFlow           = 64829.19844798195 = kg/h
VolumeFlow         = 110.91121544398143 = m3/hr
StdLiqVolumeFlow   = 93.77108462502142 = m3/hr
H                  = -213999.65787397354 = kJ/kmol
Energy             = -35255009.32117435 = W
MolecularWeight    = 109.31012638141624 = 
ZFactor            = 0.04020473390344537 = 
PROPANE            = 0.05629071461962695 = 
N-BUTANE           = 0.11001241035215306 = 
ISOBUTANE          = 0.09256835199144821 = 
N-NONANE           = 0.7411285230367718 = 

>> flash.In
Port: /flash.In + sim21.old.solver.Ports.Port_Material
Connected to: /mixer.Out
VapFrac            = 0.6757341024549764 = 
T                  = 126.84989168459111 ~ C
P                  = 715.0 = kPa
MoleFlow           = 2445.757871322051 = kgmole/h
MassFlow           = 183891.1930868653 = kg/h
VolumeFlow         = 7144.181872792055 = m3/hr
StdLiqVolumeFlow   = 289.55341021337745 = m3/hr
H                  = -149788.86915040083 = kJ/kmol
Energy             = -101763140.48917265 = W
MolecularWeight    = 75.18781611340094 = 
ZFactor            = 0.6279875374545221 = 
PROPANE            = 0.23415866270071958 ~ 
N-BUTANE           = 0.23855184789587894 ~ 
ISOBUTANE          = 0.23712522514988285 ~ 
N-NONANE           = 0.29016426425351866 ~ 

>> stream.Out
Port: /stream.Out + sim21.old.solver.Ports.Port_Material
Connected to: /mixer.In0
VapFrac            = 0.7359174890688774 = 
T                  = 126.85000000000002 = C
P                  = 715.0 = kPa
MoleFlow           = 2245.764485699994 = kgmole/h
MassFlow           = 162029.16781058203 = kg/h
VolumeFlow         = 7106.845220292526 = m3/hr
StdLiqVolumeFlow   = 257.93166559385855 = m3/hr
H                  = -144070.03251214366 = kJ/kmol
Energy             = -89874267.35261548 = W
MolecularWeight    = 72.14878 = 
ZFactor            = 0.6803376613656175 = 
PROPANE            = 0.25 = 
N-BUTANE           = 0.25 = 
ISOBUTANE          = 0.25 = 
N-NONANE           = 0.25 = 

>> 
>> #Copy the whole flowsheet
>> copy /
Copied / to the clipboard
>> paste /
Pasting /
Pasted / as /RootClone
Iteration 1 -> max Error 0.000003 in /RootClone.flash.In.Fraction.N-NONANE
>> copy /
Copied / to the clipboard
>> paste /
Pasting /
Pasted / as /RootClone_1
Iteration 1 -> max Error 0.000003 in /RootClone_1.RootClone.flash.In.Fraction.N-NONANE
Iteration 1 -> max Error 0.000003 in /RootClone_1.flash.In.Fraction.N-NONANE
>> 
>> /flash.In.State = 0
Changed state of port /flash.In to 0 (0=Normal port; 1=Recycle port)
>> /flash.In
Port: /flash.In + sim21.old.solver.Ports.Port_Material
Connected to: /mixer.Out
VapFrac            = 0.6757341024549764 = 
T                  = 126.84989168459111 * C
P                  = 715.0 = kPa
MoleFlow           = 2445.757871322051 = kgmole/h
MassFlow           = 183891.1930868653 = kg/h
VolumeFlow         = 7144.181872792055 = m3/hr
StdLiqVolumeFlow   = 289.55341021337745 = m3/hr
H                  = -149788.86915040083 = kJ/kmol
Energy             = -101763140.48917265 = W
MolecularWeight    = 75.18781611340094 = 
ZFactor            = 0.6279875374545221 = 
PROPANE            = 0.23415866270071958 * 
N-BUTANE           = 0.23855184789587894 * 
ISOBUTANE          = 0.23712522514988285 * 
N-NONANE           = 0.29016426425351866 * 

>> /flash.In.State = 1
Changed state of port /flash.In to 1 (0=Normal port; 1=Recycle port)
>> /flash.In
Port: /flash.In + sim21.old.solver.Ports.Port_Material
Connected to: /mixer.Out
VapFrac            = 0.6757341024549764 = 
T                  = 126.84989168459111 ~ C
P                  = 715.0 = kPa
MoleFlow           = 2445.757871322051 = kgmole/h
MassFlow           = 183891.1930868653 = kg/h
VolumeFlow         = 7144.181872792055 = m3/hr
StdLiqVolumeFlow   = 289.55341021337745 = m3/hr
H                  = -149788.86915040083 = kJ/kmol
Energy             = -101763140.48917265 = W
MolecularWeight    = 75.18781611340094 = 
ZFactor            = 0.6279875374545221 = 
PROPANE            = 0.23415866270071958 ~ 
N-BUTANE           = 0.23855184789587894 ~ 
ISOBUTANE          = 0.23712522514988285 ~ 
N-NONANE           = 0.29016426425351866 ~ 

>> 
>> 
