>> # Depeopanizer test (from old Hysim manual)
>> units SI
>> $thermo = Sim21Thermo.SRK
pkgName: SRK
>> / -> $thermo
Thermo case attached to a unit operation. / to /thermo
>> thermo + propane isobutane n-butane isopentane n-pentane
propane isobutane n-butane isopentane n-pentane 
>> thermo + n-hexane n-heptane n-octane
n-hexane n-heptane n-octane 
>> thermo + n-nonane n-decane
n-nonane n-decane 
>> 
>> stab = Tower.Tower()
>> stab.Stage_0 + 10  # twelve stages
>> stab.LiquidPhases = 2
>> 
>> cd stab.Stage_0
/stab.Stage_0
>> 
>> l = Tower.LiquidDraw()
>> l.Port.P = 1000
>> 
>> cond = Tower.EnergyFeed(0)
>> 
>> estT = Tower.Estimate('T')
>> estT.Value = 25
>> 
>> reflux = Tower.StageSpecification('Reflux')
>> reflux.Value = 2
>> 
>> cd ../Stage_5
/stab.Stage_5
>> f = Tower.Feed()
>> f.Port.T = 50
>> f.Port.P = 2000
>> f.Port.MoleFlow = 1000
>> f.Port.Fraction = .1702 .1473 .1132 .1166 .1066 .0963 .0829 .0694 .0558 .0417
>> f.Port
Port: /stab.Feed_5_f + sim21.old.solver.Ports.Port_Material
Connected to: None
VapFrac            = 0.0 = 
T                  = 50.0 * C
P                  = 2000.0 * kPa
MoleFlow           = 1000.0000000000001 * kgmole/h
MassFlow           = 76372.18765800002 = kg/h
VolumeFlow         = 124.40341958401764 = m3/hr
StdLiqVolumeFlow   = 119.79586300000003 = m3/hr
H                  = -177715.30446131917 = kJ/kmol
Energy             = -49365362.35036644 = W
MolecularWeight    = 76.37218765800002 = 
ZFactor            = 0.09260276805655693 = 
PROPANE            = 0.17020000000000002 * 
ISOBUTANE          = 0.14730000000000001 * 
N-BUTANE           = 0.11320000000000001 * 
ISOPENTANE         = 0.11660000000000001 * 
N-PENTANE          = 0.10660000000000001 * 
N-HEXANE           = 0.09630000000000001 * 
N-HEPTANE          = 0.08290000000000002 * 
N-OCTANE           = 0.06940000000000002 * 
N-NONANE           = 0.05580000000000001 * 
N-DECANE           = 0.04170000000000001 * 

>> 
>> cd ../Stage_11
/stab.Stage_11
>> l = Tower.LiquidDraw()
>> l.Port.P = 1100
>> l.Port.Fraction.n-BUTANE = .02
>> 
>> reb = Tower.EnergyFeed(1)
>> estT = Tower.Estimate('T')
>> estT.Value = 100
>> 
>> cd ../Stage_9
/stab.Stage_9
>> pa_source = Tower.VapourDraw()
>> pa_source.Port.MoleFlow = 200
>> 
>> cd ../Stage_7
/stab.Stage_7
>> pa_dest = Tower.Feed()
>> 
>> cd ..
/stab
>> Stage_9.pa_source.Port -> Stage_7.pa_dest.Port
>> 
>> /overhead = Stream.Stream_Material()
>> /overhead.In -> Stage_0.l.Port
>> 
>> /bottoms = Stream.Stream_Material()
>> /bottoms.In -> Stage_11.l.Port
>> 
>> 
>> 
>> TryToSolve = 1  # start calculation
Calculating Jacobian for /stab
Calculating disturbance 10 of 13 in jacobian of /stab
/stab Inner Error 0.109473
/stab Inner Error 0.034570
/stab Inner Error 0.008582
/stab Inner Error 0.003916
/stab Inner Error 0.000900
/stab Inner Error 0.000352
/stab Inner Error 0.000016
/stab Inner Error 0.000002
Inner loop converged
/stab Iteration 1 Outer Error 0.127748
/stab Inner Error 0.046141
/stab Inner Error 0.019237
/stab Inner Error 0.009011
/stab Inner Error 0.000824
/stab Inner Error 0.000767
/stab Inner Error 0.000040
/stab Inner Error 0.000002
Inner loop converged
/stab Iteration 2 Outer Error 0.002386
/stab Inner Error 0.005744
/stab Inner Error 0.000454
/stab Inner Error 0.000142
/stab Inner Error 0.000005
Inner loop converged
/stab Iteration 3 Outer Error 0.000168
/stab Inner Error 0.000259
/stab Inner Error 0.000040
/stab Inner Error 0.000003
Inner loop converged
/stab Iteration 4 Outer Error 0.000008
/stab Inner Error 0.000036
/stab Inner Error 0.000006
Inner loop converged
>> 
>> /overhead.Out
Port: /overhead.Out + sim21.old.solver.Ports.Port_Material
Connected to: None
VapFrac            = 0.0 = 
T                  = 50.72661277972179 = C
P                  = 1000.0 = kPa
MoleFlow           = 432.03016118751265 = kgmole/h
MassFlow           = 22959.32650950553 = kg/h
VolumeFlow         = 44.027595538858826 = m3/hr
StdLiqVolumeFlow   = 39.87293207228168 = m3/hr
H                  = -137009.91351690158 = kJ/kmol
Energy             = -16442337.50583171 = W
MolecularWeight    = 53.14287870654966 = 
ZFactor            = 0.03784400815001687 = 
PROPANE            = 0.3937017867139459 = 
ISOBUTANE          = 0.331968735505624 = 
N-BUTANE           = 0.23573183010041202 = 
ISOPENTANE         = 0.028957430370957216 = 
N-PENTANE          = 0.00952968624302474 = 
N-HEXANE           = 0.00010877768898687006 = 
N-HEPTANE          = 1.7204694140458021e-06 = 
N-OCTANE           = 3.1967697553510135e-08 = 
N-NONANE           = 3.0223369410181934e-10 = 
N-DECANE           = 6.377039459507114e-10 = 

>> /bottoms.Out
Port: /bottoms.Out + sim21.old.solver.Ports.Port_Material
Connected to: None
VapFrac            = 1.682971567744186e-05 = 
T                  = 165.99880538355137 = C
P                  = 1100.0 = kPa
MoleFlow           = 567.969838812488 = kgmole/h
MassFlow           = 53412.76569886425 = kg/h
VolumeFlow         = 105.4840680474598 = m3/hr
StdLiqVolumeFlow   = 79.92282400554717 = m3/hr
H                  = -179897.89913256423 = kJ/kmol
Energy             = -28382383.548063256 = W
MolecularWeight    = 94.04155299960948 = 
ZFactor            = 0.055951069298965116 = 
PROPANE            = 0.0001918299506715197 = 
ISOBUTANE          = 0.006830457227098508 = 
N-BUTANE           = 0.02 = 
ISOPENTANE         = 0.1832659228998666 = 
N-PENTANE          = 0.1804372012616568 = 
N-HEXANE           = 0.1694685143118503 = 
N-HEPTANE          = 0.1459571460319928 = 
N-OCTANE           = 0.12218956262552966 = 
N-NONANE           = 0.09824465324794826 = 
N-DECANE           = 0.07341939109245499 = 

>> L
[ 864.06032238  830.00263149  801.76152779  766.53795154  686.51586428
 2102.52529743 2155.00945646 2197.93599027 2221.71583393 2190.36761911
 2030.08587697  567.96983881]
>> V
[1.03603701e-40 1.29609048e+03 1.26203279e+03 1.23379169e+03
 1.19856811e+03 1.11854603e+03 1.53455546e+03 1.58703962e+03
 1.42996799e+03 1.45374784e+03 1.62239778e+03 1.46211604e+03]
>> T
[323.87661278 335.81234738 344.38827901 351.21502766 358.04625479
 370.16545486 380.40387408 389.20296186 396.12484249 404.10384671
 415.58663479 439.14880538]
>> 
>> # remove feed and draw and install VapourPumpAround object
>> TryToSolve = 0
>> delete Stage_9.pa_source
>> delete Stage_7.pa_dest
>> 
>> Stage_9.pa = Tower.VapourPumpAround(7)
>> Stage_7.pa_paR.Port.MoleFlow = 200
>> Stage_7.pa_paQ.Port.Energy = 0
>> TryToSolve = 1
/stab Inner Error 0.000001
Inner loop converged
/stab Iteration 1 Outer Error 0.000001
/stab Inner Error 0.000002
Inner loop converged
>> 
>> /overhead.Out
Port: /overhead.Out + sim21.old.solver.Ports.Port_Material
Connected to: None
VapFrac            = 0.0 = 
T                  = 50.72597068573589 = C
P                  = 1000.0 = kPa
MoleFlow           = 432.0211111195843 = kgmole/h
MassFlow           = 22958.735013112677 = kg/h
VolumeFlow         = 44.026510959758866 = m3/hr
StdLiqVolumeFlow   = 39.871945451327306 = m3/hr
H                  = -137009.5258945335 = kJ/kmol
Energy             = -16441946.55858995 = W
MolecularWeight    = 53.142622816958884 = 
ZFactor            = 0.03784394366910764 = 
PROPANE            = 0.39370996001964287 = 
ISOBUTANE          = 0.3319730180248935 = 
N-BUTANE           = 0.2357294108187924 = 
ISOPENTANE         = 0.02895001537577453 = 
N-PENTANE          = 0.009527097408855923 = 
N-HEXANE           = 0.00010874559360672479 = 
N-HEPTANE          = 1.7198643684374472e-06 = 
N-OCTANE           = 3.1954535251241716e-08 = 
N-NONANE           = 3.0208708603054775e-10 = 
N-DECANE           = 6.374432436482828e-10 = 

>> /bottoms.Out
Port: /bottoms.Out + sim21.old.solver.Ports.Port_Material
Connected to: None
VapFrac            = 0.0 = 
T                  = 165.9971931921787 = C
P                  = 1100.0 = kPa
MoleFlow           = 567.9788888804163 = kgmole/h
MassFlow           = 53413.4648658854 = kg/h
VolumeFlow         = 105.46157586302354 = m3/hr
StdLiqVolumeFlow   = 79.9239312385725 = m3/hr
H                  = -179898.29708863274 = kJ/kmol
Energy             = -28382898.58107796 = W
MolecularWeight    = 94.0412855329403 = 
ZFactor            = 0.055938452985855806 = 
PROPANE            = 0.00019188321185965797 = 
ISOBUTANE          = 0.006832380511207384 = 
N-BUTANE           = 0.02 = 
ISOPENTANE         = 0.18326910423662768 = 
N-PENTANE          = 0.18043644719559143 = 
N-HEXANE           = 0.16946584017858812 = 
N-HEPTANE          = 0.1459548208661297 = 
N-OCTANE           = 0.1221876156907266 = 
N-NONANE           = 0.09824308783638662 = 
N-DECANE           = 0.07341822124200588 = 

>> Stage_7.pa_paR.Port
Port: /stab.Feed_7_pa_paR + sim21.old.solver.Ports.Port_Material
Connected to: None
VapFrac            = 0.9999989865115005 = 
T                  = 130.95222625869593 = C
P                  = 1081.8181818181818 = kPa
MoleFlow           = 200.0 * kgmole/h
MassFlow           = 14202.963261991023 = kg/h
VolumeFlow         = 491.6085173853796 = m3/hr
StdLiqVolumeFlow   = 22.989920059285904 = m3/hr
H                  = -136168.9166899416 = kJ/kmol
Energy             = -7564939.816107866 = W
MolecularWeight    = 71.01481630995511 = 
ZFactor            = 0.7914404648183984 = 
PROPANE            = 0.007679944640292279 = 
ISOBUTANE          = 0.07609316179996872 = 
N-BUTANE           = 0.14419132073770058 = 
ISOPENTANE         = 0.3854439095098626 = 
N-PENTANE          = 0.281928395373193 = 
N-HEXANE           = 0.0716778250517437 = 
N-HEPTANE          = 0.021201938873142725 = 
N-OCTANE           = 0.007599322931580037 = 
N-NONANE           = 0.0030002052109286696 = 
N-DECANE           = 0.0011839758715877005 = 

>> L
[ 864.04222224  829.99295073  801.75470691  766.53114798  686.50729608
 2102.52547331 2154.99493516 2197.89101694 2221.61782544 2190.27100983
 2030.00762139  567.97888888]
>> V
[1.03599165e-40 1.29606333e+03 1.26201406e+03 1.23377582e+03
 1.19855226e+03 1.11852841e+03 1.53454658e+03 1.58701605e+03
 1.42991062e+03 1.45363743e+03 1.62229212e+03 1.46202873e+03]
>> T
[323.87597069 335.81122127 344.38669591 351.21313048 358.04425443
 370.16361508 380.4016362  389.20079302 396.12298806 404.10223103
 415.58507969 439.14719319]
>> 
>> # delete the pump around
>> delete Stage_9.pa
Calculating Jacobian for /stab
Calculating disturbance 10 of 12 in jacobian of /stab
/stab Inner Error 0.031497
/stab Inner Error 0.005414
/stab Inner Error 0.000750
/stab Inner Error 0.000229
/stab Inner Error 0.000058
/stab Inner Error 0.000010
/stab Inner Error 0.000001
Inner loop converged
/stab Iteration 1 Outer Error 0.118223
/stab Inner Error 0.020633
/stab Inner Error 0.016523
/stab Inner Error 0.005120
/stab Inner Error 0.004499
/stab Inner Error 0.000632
/stab Inner Error 0.000102
/stab Inner Error 0.000017
/stab Inner Error 0.000001
Inner loop converged
/stab Iteration 2 Outer Error 0.002387
/stab Inner Error 0.002121
/stab Inner Error 0.000505
/stab Inner Error 0.000030
/stab Inner Error 0.000001
Inner loop converged
/stab Iteration 3 Outer Error 0.000164
/stab Inner Error 0.000190
/stab Inner Error 0.000028
/stab Inner Error 0.000002
Inner loop converged
/stab Iteration 4 Outer Error 0.000009
/stab Inner Error 0.000023
/stab Inner Error 0.000001
Inner loop converged
>> 
>> # add liquid pump down
>> Stage_7.pd = Tower.LiquidPumpAround(10)
>> Stage_7.pd.Port.MoleFlow = 300
>> Stage_10.pd_paQ.Port.Energy = 1000000
Calculating Jacobian for /stab
Calculating disturbance 10 of 13 in jacobian of /stab
/stab Inner Error 0.092201
/stab Inner Error 0.016233
/stab Inner Error 0.012355
/stab Inner Error 0.001492
/stab Inner Error 0.000399
/stab Inner Error 0.000033
/stab Inner Error 0.000007
Inner loop converged
/stab Iteration 1 Outer Error 0.132475
/stab Inner Error 0.022819
/stab Inner Error 0.022533
/stab Inner Error 0.022382
/stab Inner Error 0.016820
/stab Inner Error 0.006121
/stab Inner Error 0.002262
/stab Inner Error 0.000332
/stab Inner Error 0.000020
/stab Inner Error 0.000001
Inner loop converged
/stab Iteration 2 Outer Error 0.002717
/stab Inner Error 0.008528
/stab Inner Error 0.000654
/stab Inner Error 0.000116
/stab Inner Error 0.000011
/stab Inner Error 0.000003
Inner loop converged
/stab Iteration 3 Outer Error 0.000186
/stab Inner Error 0.000608
/stab Inner Error 0.000048
/stab Inner Error 0.000003
Inner loop converged
/stab Iteration 4 Outer Error 0.000009
/stab Inner Error 0.000045
/stab Inner Error 0.000008
Inner loop converged
>> /overhead.Out
Port: /overhead.Out + sim21.old.solver.Ports.Port_Material
Connected to: None
VapFrac            = 0.0 = 
T                  = 50.93989332809457 = C
P                  = 1000.0 = kPa
MoleFlow           = 433.91222513386316 = kgmole/h
MassFlow           = 23102.37581789417 = kg/h
VolumeFlow         = 44.27684522718608 = m3/hr
StdLiqVolumeFlow   = 40.098818797862165 = m3/hr
H                  = -137164.81089658788 = kJ/kmol
Energy             = -16532635.640612224 = W
MolecularWeight    = 53.242048537371986 = 
ZFactor            = 0.037868239068391485 = 
PROPANE            = 0.39181754098587507 = 
ISOBUTANE          = 0.3296158107124535 = 
N-BUTANE           = 0.2347982271286181 = 
ISOPENTANE         = 0.03273220317995864 = 
N-PENTANE          = 0.010910831705737714 = 
N-HEXANE           = 0.00012337519165582096 = 
N-HEPTANE          = 1.9727780841672302e-06 = 
N-OCTANE           = 3.720745732778769e-08 = 
N-NONANE           = 3.5831740359282953e-10 = 
N-DECANE           = 7.51842241127914e-10 = 

>> /bottoms.Out
Port: /bottoms.Out + sim21.old.solver.Ports.Port_Material
Connected to: None
VapFrac            = 2.2682669178082603e-05 = 
T                  = 166.08347099414658 = C
P                  = 1100.0 = kPa
MoleFlow           = 566.0877748661369 = kgmole/h
MassFlow           = 53269.68315353024 = kg/h
VolumeFlow         = 105.20115529181786 = m3/hr
StdLiqVolumeFlow   = 79.69690004225045 = m3/hr
H                  = -179956.08862225077 = kJ/kmol
Energy             = -28297483.82827313 = W
MolecularWeight    = 94.10145478963392 = 
ZFactor            = 0.055975735129664556 = 
PROPANE            = 0.00032782715433877043 = 
ISOBUTANE          = 0.007553016200479207 = 
N-BUTANE           = 0.02 = 
ISOPENTANE         = 0.18088554713774643 = 
N-PENTANE          = 0.17994675253425166 = 
N-HEXANE           = 0.17002039307211977 = 
N-HEPTANE          = 0.1464422085551575 = 
N-OCTANE           = 0.12259580039798683 = 
N-NONANE           = 0.09857128580053998 = 
N-DECANE           = 0.07366348740462957 = 

>> Stage_10.pd_paR.Port
Port: /stab.Feed_10_pd_paR + sim21.old.solver.Ports.Port_Material
Connected to: None
VapFrac            = 0.0 = 
T                  = 57.11462760185401 = C
P                  = 1063.6363636363637 = kPa
MoleFlow           = 299.9963692827036 = kgmole/h
MassFlow           = 22704.5938828559 = kg/h
VolumeFlow         = 37.16894289488733 = m3/hr
StdLiqVolumeFlow   = 36.06253969441852 = m3/hr
H                  = -176209.298138683 = kJ/kmol
Energy             = -14683930.4654051 = W
MolecularWeight    = 75.68289555351275 = 
ZFactor            = 0.04799114820264677 = 
PROPANE            = 0.013016800950808836 = 
ISOBUTANE          = 0.08161771585565768 = 
N-BUTANE           = 0.13455800869961143 = 
ISOPENTANE         = 0.32006612297893455 = 
N-PENTANE          = 0.2363095089895293 = 
N-HEXANE           = 0.08316050382890645 = 
N-HEPTANE          = 0.04896476596799442 = 
N-OCTANE           = 0.03572031715980181 = 
N-NONANE           = 0.027014660946877867 = 
N-DECANE           = 0.019571594621877707 = 

>> L
[ 867.82445027  831.39735376  802.12860735  767.19088425  688.61383789
 2107.19345067 2163.84975434 1910.71907638 1928.01394154 1894.04424359
 2167.92217754  566.08777487]
>> V
[1.18803788e-40 1.30173668e+03 1.26530958e+03 1.23604083e+03
 1.20110311e+03 1.12252606e+03 1.54110568e+03 1.59776198e+03
 1.64462767e+03 1.66192254e+03 1.62795284e+03 1.60183440e+03]
>> T
[324.08989333 336.35715545 345.26451169 352.31955913 359.22137382
 371.18987036 381.7021726  390.5314292  398.24998587 405.35624491
 414.90944574 439.23347099]
>> 
