>> # Depeopanizer test with some changes
>> units Field
>> $thermo = Sim21Thermo.Peng-Robinson
pkgName: Peng-Robinson
>> / -> $thermo
Thermo case attached to a unit operation. / to /thermo
>> thermo + Methane Ethane PROPANE
Methane Ethane PROPANE 
>> thermo + ISOBUTANE n-BUTANE ISOPENTANE n-PENTANE n-Hexane
ISOBUTANE n-BUTANE ISOPENTANE n-PENTANE n-Hexane 
>> thermo + n-Heptane n-Octane
n-Heptane n-Octane 
>> 
>> deprop = Tower.Tower()
>> deprop.Stage_0 + 18  # twenty stages`
>> 
>> cd deprop.Stage_0
/deprop.Stage_0
>> 
>> v = Tower.VapourDraw()
>> v.Port.P = 200
>> v.Port.Fraction.ISOBUTANE = .01
>> 
>> cond = Tower.EnergyFeed(0)
>> estT = Tower.Estimate('T')
>> estT.Value = 25
>> 
>> cd ../Stage_9
/deprop.Stage_9
>> f = Tower.Feed()
>> f.Port.T = 50
>> f.Port.P = 480
>> f.Port.MoleFlow = 1000
>> f.Port.Fraction = .1702 .1473 .1132 .1166 .1066 .0963 .0829 .0694 .0558 .0417
>> f.Port
Port: /deprop.Feed_9_f + sim21.solver.Ports.Port_Material
Connected to: None
VapFrac            = 0.0012160707513159594 = 
T                  = 49.99999999999999 * F
P                  = 480.0 * psia
MoleFlow           = 1000.0000000000001 * lbmole/h
MassFlow           = 54388.326918000006 = lb/h
VolumeFlow         = 0.41581234564493885 = ft3/s
StdLiqVolumeFlow   = 0.39667686847159 = ft3/s
H                  = -62299.579667023754 = Btu/lbmol
Energy             = -62289103.30841242 = Btu/hr
MolecularWeight    = 54.388326918 = 
ZFactor            = 0.13136681933415006 = 
METHANE            = 0.17020000000000002 * 
ETHANE             = 0.14730000000000001 * 
PROPANE            = 0.11320000000000001 * 
ISOBUTANE          = 0.11660000000000001 * 
N-BUTANE           = 0.10660000000000001 * 
ISOPENTANE         = 0.09630000000000001 * 
N-PENTANE          = 0.08290000000000002 * 
N-HEXANE           = 0.06940000000000002 * 
N-HEPTANE          = 0.05580000000000001 * 
N-OCTANE           = 0.04170000000000001 * 

>> 
>> cd ../Stage_19
/deprop.Stage_19
>> l = Tower.LiquidDraw()
>> 
>> l.c3flow = Tower.ComponentMoleFlowSpec()
>> l.c3flow + PROPANE
>> l.c3flow.Port = 12
>> 
>> reb = Tower.EnergyFeed(1)
>> #reb.Port.Energy = 8.42e6
>> estT = Tower.Estimate('T')
>> estT.Value = 250
>> 
>> cd ..
/deprop
>> 
>> /overhead = Stream.Stream_Material()
>> /overhead.In -> Stage_0.v.Port
>> 
>> /bottoms = Stream.Stream_Material()
>> /bottoms.In -> Stage_19.l.Port
>> 
>> 
>> 
>> TryToSolve = 1  # start calculation
Calculating Jacobian for /deprop
Calculating disturbance 10 of 20 in jacobian of /deprop
Calculating disturbance 20 of 20 in jacobian of /deprop
/deprop Inner Error 1.529796
/deprop Inner Error 0.236581
/deprop Inner Error 0.213206
Step size too small - Exiting inner loop
/deprop Iteration 1 Outer Error 0.104723
Calculating Jacobian for /deprop
Calculating disturbance 10 of 20 in jacobian of /deprop
Calculating disturbance 20 of 20 in jacobian of /deprop
/deprop Inner Error 0.050928
/deprop Inner Error 0.001467
Step size too small - Exiting inner loop
/deprop Iteration 2 Outer Error 0.015191
Calculating Jacobian for /deprop
Calculating disturbance 10 of 20 in jacobian of /deprop
Calculating disturbance 20 of 20 in jacobian of /deprop
/deprop Inner Error 0.187990
/deprop Inner Error 0.049681
/deprop Inner Error 0.010776
/deprop Inner Error 0.001740
/deprop Inner Error 0.000092
/deprop Inner Error 0.000002
Inner loop converged
/deprop Iteration 3 Outer Error 0.001262
/deprop Inner Error 0.013791
/deprop Inner Error 0.000381
/deprop Inner Error 0.000025
/deprop Inner Error 0.000001
Inner loop converged
/deprop Iteration 4 Outer Error 0.000223
/deprop Inner Error 0.000912
/deprop Inner Error 0.000042
/deprop Inner Error 0.000001
Inner loop converged
/deprop Iteration 5 Outer Error 0.000041
/deprop Inner Error 0.000038
/deprop Inner Error 0.000006
Inner loop converged
>> 
>> /overhead.Out
Port: /overhead.Out + sim21.solver.Ports.Port_Material
Connected to: None
VapFrac            = 1.0 = 
T                  = 24.443996474818906 = F
P                  = 200.0 = psia
MoleFlow           = 423.19681435237374 = lbmole/h
MassFlow           = 11883.530574250968 = lb/h
VolumeFlow         = 2.6309323487919816 = ft3/s
StdLiqVolumeFlow   = 0.09296147048008171 = ft3/s
H                  = -37813.937808483715 = Btu/lbmol
Energy             = -16000046.9824993 = Btu/hr
MolecularWeight    = 28.080386890150532 = 
ZFactor            = 0.8615605176800993 = 
METHANE            = 0.40217694036138757 = 
ETHANE             = 0.34805725063502085 = 
PROPANE            = 0.23913220193983048 = 
ISOBUTANE          = 0.01 = 
N-BUTANE           = 0.0006334426054600876 = 
ISOPENTANE         = 1.3305349418601049e-07 = 
N-PENTANE          = 5.830245510340905e-09 = 
N-HEXANE           = 1.4096971070506343e-09 = 
N-HEPTANE          = 1.0643466882753308e-09 = 
N-OCTANE           = 4.550408426999446e-10 = 

>> /bottoms.Out
Port: /bottoms.Out + sim21.solver.Ports.Port_Material
Connected to: None
VapFrac            = 1.571463875318415e-08 = 
T                  = 253.70449049976935 = F
P                  = 200.0 = psia
MoleFlow           = 576.803185647626 = lbmole/h
MassFlow           = 42504.79605584352 = lb/h
VolumeFlow         = 0.3774172082849826 = ft3/s
StdLiqVolumeFlow   = 0.30371539564646927 = ft3/s
H                  = -68604.273169706 = Btu/lbmol
Energy             = -39564508.987570845 = Btu/hr
MolecularWeight    = 73.69029352711796 = 
ZFactor            = 0.061537889413371315 = 
METHANE            = 5.734387956453441e-11 = 
ETHANE             = 5.6870681282945495e-06 = 
PROPANE            = 0.020804347528909053 = 
ISOBUTANE          = 0.1948117227314157 = 
N-BUTANE           = 0.18434698655123793 = 
ISOPENTANE         = 0.16695459749248961 = 
N-PENTANE          = 0.14372319639597664 = 
N-HEXANE           = 0.12031833583841844 = 
N-HEPTANE          = 0.09674010292942553 = 
N-OCTANE           = 0.07229502340665474 = 

>> 
>> cd Stage_19
/deprop.Stage_19
>> delete l.c3flow
>> 
>> c = Tower.InternalLiquidClone()
>> c.Port.T = 255
/deprop Inner Error 0.001440
Inner loop is not changing significantly - exiting
/deprop Iteration 1 Outer Error 0.000008
Calculating Jacobian for /deprop
Calculating disturbance 10 of 20 in jacobian of /deprop
Calculating disturbance 20 of 20 in jacobian of /deprop
/deprop Inner Error 0.000154
/deprop Inner Error 0.000014
/deprop Inner Error 0.000000
Inner loop converged
>> 
>> /overhead.Out
Port: /overhead.Out + sim21.solver.Ports.Port_Material
Connected to: None
VapFrac            = 1.0 = 
T                  = 25.470491683596414 = F
P                  = 200.0 = psia
MoleFlow           = 426.08952670435326 = lbmole/h
MassFlow           = 12011.300679700746 = lb/h
VolumeFlow         = 2.653890397201987 = ft3/s
StdLiqVolumeFlow   = 0.09392737895771038 = ft3/s
H                  = -37861.60083864546 = Btu/lbmol
Energy             = -16129718.736040654 = Btu/hr
MolecularWeight    = 28.189616611598453 = 
ZFactor            = 0.8613521379463538 = 
METHANE            = 0.3994465427134599 = 
ETHANE             = 0.3456966004738416 = 
PROPANE            = 0.24425733726268073 = 
ISOBUTANE          = 0.01 = 
N-BUTANE           = 0.000599361645213851 = 
ISOPENTANE         = 1.2183663190916164e-07 = 
N-PENTANE          = 5.320288444999356e-09 = 
N-HEXANE           = 1.3511938599128118e-09 = 
N-HEPTANE          = 1.0442120978417728e-09 = 
N-OCTANE           = 4.5068941014515674e-10 = 

>> /bottoms.Out
Port: /bottoms.Out + sim21.solver.Ports.Port_Material
Connected to: None
VapFrac            = 0.0 = 
T                  = 254.9998727178186 = F
P                  = 200.0 = psia
MoleFlow           = 573.9104732956474 = lbmole/h
MassFlow           = 42377.02588244102 = lb/h
VolumeFlow         = 0.37676611630681534 = ft3/s
StdLiqVolumeFlow   = 0.302749486613998 = ft3/s
H                  = -68648.7220125325 = Btu/lbmol
Energy             = -39391595.297824994 = Btu/hr
MolecularWeight    = 73.8390878965728 = 
ZFactor            = 0.061629456591733855 = 
METHANE            = 2.033685065076695e-08 = 
ETHANE             = 4.006061753381743e-06 = 
PROPANE            = 0.015898832999652154 = 
ISOBUTANE          = 0.19574323535027402 = 
N-BUTANE           = 0.18529827077311972 = 
ISOPENTANE         = 0.16779611553992108 = 
N-PENTANE          = 0.14444761263378325 = 
N-HEXANE           = 0.12092478296439685 = 
N-HEPTANE          = 0.09722770737157652 = 
N-OCTANE           = 0.0726594159686722 = 

>> 
>> c.Port.T = None
>> c.c3spec = Tower.MassFractionSpec()
>> c.c3spec + PROPANE
>> c.c3spec.Port = .02
/deprop Inner Error 0.010506
Inner loop is not changing significantly - exiting
/deprop Iteration 1 Outer Error 0.004719
Calculating Jacobian for /deprop
Calculating disturbance 10 of 20 in jacobian of /deprop
Calculating disturbance 20 of 20 in jacobian of /deprop
/deprop Inner Error 0.009521
/deprop Inner Error 0.001671
/deprop Inner Error 0.000088
/deprop Inner Error 0.000029
/deprop Inner Error 0.000003
Inner loop converged
/deprop Iteration 2 Outer Error 0.015061
/deprop Inner Error 0.002057
/deprop Inner Error 0.000178
/deprop Inner Error 0.000022
/deprop Inner Error 0.000002
Inner loop converged
/deprop Iteration 3 Outer Error 0.001658
/deprop Inner Error 0.000214
/deprop Inner Error 0.000021
/deprop Inner Error 0.000001
Inner loop converged
/deprop Iteration 4 Outer Error 0.000296
/deprop Inner Error 0.000020
/deprop Inner Error 0.000002
Inner loop converged
/deprop Iteration 5 Outer Error 0.000059
/deprop Inner Error 0.000001
Inner loop converged
>> 
>> /overhead.Out
Port: /overhead.Out + sim21.solver.Ports.Port_Material
Connected to: None
VapFrac            = 0.9999897181808292 = 
T                  = 22.196820983410195 = F
P                  = 200.0 = psia
MoleFlow           = 415.7035297593982 = lbmole/h
MassFlow           = 11552.271973738745 = lb/h
VolumeFlow         = 2.575331467335259 = ft3/s
StdLiqVolumeFlow   = 0.09045707935508769 = ft3/s
H                  = -37680.416300615114 = Btu/lbmol
Energy             = -15661248.005151054 = Btu/hr
MolecularWeight    = 27.78968897968671 = 
ZFactor            = 0.8625584518251256 = 
METHANE            = 0.40942640071809344 = 
ETHANE             = 0.35432571799220725 = 
PROPANE            = 0.2255712792661768 = 
ISOBUTANE          = 0.01 = 
N-BUTANE           = 0.0006762428838836657 = 
ISOPENTANE         = 1.356638843616042e-07 = 
N-PENTANE          = 5.7366787566069e-09 = 
N-HEXANE           = 1.2146826643054327e-09 = 
N-HEPTANE          = 8.604910585202186e-10 = 
N-OCTANE           = 3.5613979952185033e-10 = 

>> /bottoms.Out
Port: /bottoms.Out + sim21.solver.Ports.Port_Material
Connected to: None
VapFrac            = 0.0 = 
T                  = 250.38719473343372 = F
P                  = 200.0 = psia
MoleFlow           = 584.2964702406017 = lbmole/h
MassFlow           = 42836.05222937426 = lb/h
VolumeFlow         = 0.3791083204948422 = ft3/s
StdLiqVolumeFlow   = 0.306219767030402 = ft3/s
H                  = -68491.18840813849 = Btu/lbmol
Energy             = -40012429.9682025 = Btu/hr
MolecularWeight    = 73.3121872377844 = 
ZFactor            = 0.06130598097716545 = 
METHANE            = 7.667800178236338e-11 = 
ETHANE             = 9.495772076028202e-06 = 
PROPANE            = 0.03325233676100552 = 
ISOBUTANE          = 0.19244147607447915 = 
N-BUTANE           = 0.18196050953793155 = 
ISOPENTANE         = 0.164813495389404 = 
N-PENTANE          = 0.14188002467498378 = 
N-HEXANE           = 0.11877531874610604 = 
N-HEPTANE          = 0.09549946385832786 = 
N-OCTANE           = 0.07136787910900816 = 

>> 
>> #Now test TriggerSolve
>> cd /
/
>> deprop.TriggerSolve = 1
/deprop Inner Error 0.000000
Inner loop converged
/deprop Iteration 1 Outer Error 0.000012
/deprop Inner Error 0.000000
Inner loop converged
>> deprop.TryToSolve = 0
>> 
>> 
>> #Lets trigger a solve
>> deprop.TriggerSolve = 1
/deprop Inner Error 0.000000
Inner loop converged
/deprop Iteration 1 Outer Error 0.000002
/deprop Inner Error 0.000000
Inner loop converged
>> deprop.TriggerSolve
/deprop.TriggerSolve = 0 
>> deprop.TryToSolve
/deprop.TryToSolve = 0 
>> 
>> 
>> #Lets change a spec
>> deprop.Stage_19.c.c3spec.Port = 0.01
>> 
>> #Everything is forgotten. trigger a solve
>> deprop.TriggerSolve = 1
/deprop Inner Error 0.002019
/deprop Inner Error 0.000460
/deprop Inner Error 0.000080
/deprop Inner Error 0.000005
Inner loop converged
/deprop Iteration 1 Outer Error 0.011370
/deprop Inner Error 0.004427
/deprop Inner Error 0.001464
/deprop Inner Error 0.000367
/deprop Inner Error 0.000014
/deprop Inner Error 0.000001
Inner loop converged
/deprop Iteration 2 Outer Error 0.001682
/deprop Inner Error 0.000202
/deprop Inner Error 0.000008
Inner loop converged
/deprop Iteration 3 Outer Error 0.000284
/deprop Inner Error 0.000016
/deprop Inner Error 0.000000
Inner loop converged
/deprop Iteration 4 Outer Error 0.000061
/deprop Inner Error 0.000001
Inner loop converged
>> deprop.Stage_19.c.c3spec.Port = None
>> deprop.TriggerSolve = 1
>> deprop.Stage_19.c.c3spec.Port = 0.02
>> deprop.TryToSolve = 1
/deprop Inner Error 0.004459
/deprop Inner Error 0.000821
/deprop Inner Error 0.000058
/deprop Inner Error 0.000001
Inner loop converged
/deprop Iteration 1 Outer Error 0.014875
/deprop Inner Error 0.003521
/deprop Inner Error 0.000622
/deprop Inner Error 0.000015
/deprop Inner Error 0.000003
Inner loop converged
/deprop Iteration 2 Outer Error 0.001601
/deprop Inner Error 0.000232
/deprop Inner Error 0.000017
/deprop Inner Error 0.000001
Inner loop converged
/deprop Iteration 3 Outer Error 0.000270
/deprop Inner Error 0.000009
Inner loop converged
/deprop Iteration 4 Outer Error 0.000056
/deprop Inner Error 0.000001
Inner loop converged
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>> 
