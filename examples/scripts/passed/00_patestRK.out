>> # Depeopanizer test (from old Hysim manual)
>> units SI
>> $thermo = Sim21Thermo.SRK
pkgName: SRK
>> / -> $thermo
Thermo case attached to a unit operation. / to /thermo
>> thermo + propane isobutane n-butane isopentane n-pentane
propane isobutane n-butane isopentane n-pentane 
>> thermo + n-hexane n-heptane n-octane
n-hexane n-heptane n-octane 
>> thermo + n-nonane n-decane
n-nonane n-decane 
>> 
>> stab = Tower.Tower()
>> stab.Stage_0 + 10  # twelve stages
>> stab.LiquidPhases = 2
>> 
>> cd stab.Stage_0
/stab.Stage_0
>> 
>> l = Tower.LiquidDraw()
>> l.Port.P = 1000
>> 
>> cond = Tower.EnergyFeed(0)
>> 
>> estT = Tower.Estimate('T')
>> estT.Value = 25
>> 
>> reflux = Tower.StageSpecification('Reflux')
>> reflux.Value = 2
>> 
>> cd ../Stage_5
/stab.Stage_5
>> f = Tower.Feed()
>> f.Port.T = 50
>> f.Port.P = 2000
>> f.Port.MoleFlow = 1000
>> f.Port.Fraction = .1702 .1473 .1132 .1166 .1066 .0963 .0829 .0694 .0558 .0417
>> f.Port
Port: /stab.Feed_5_f + sim21.solver.Ports.Port_Material
Connected to: None
VapFrac            = 0.0 = 
T                  = 50.0 * C
P                  = 2000.0 * kPa
MoleFlow           = 1000.0000000000001 * kgmole/h
MassFlow           = 76372.18765800002 = kg/h
VolumeFlow         = 140.49371490343435 = m3/hr
StdLiqVolumeFlow   = 119.79586300000003 = m3/hr
H                  = -178134.0765521168 = kJ/kmol
Energy             = -49481687.93114357 = W
MolecularWeight    = 76.37218765800002 = 
ZFactor            = 0.10457997809152028 = 
PROPANE            = 0.17020000000000002 * 
ISOBUTANE          = 0.14730000000000001 * 
N-BUTANE           = 0.11320000000000001 * 
ISOPENTANE         = 0.11660000000000001 * 
N-PENTANE          = 0.10660000000000001 * 
N-HEXANE           = 0.09630000000000001 * 
N-HEPTANE          = 0.08290000000000002 * 
N-OCTANE           = 0.06940000000000002 * 
N-NONANE           = 0.05580000000000001 * 
N-DECANE           = 0.04170000000000001 * 

>> 
>> cd ../Stage_11
/stab.Stage_11
>> l = Tower.LiquidDraw()
>> l.Port.P = 1100
>> l.Port.Fraction.n-BUTANE = .02
>> 
>> reb = Tower.EnergyFeed(1)
>> estT = Tower.Estimate('T')
>> estT.Value = 100
>> 
>> cd ../Stage_9
/stab.Stage_9
>> pa_source = Tower.VapourDraw()
>> pa_source.Port.MoleFlow = 200
>> 
>> cd ../Stage_7
/stab.Stage_7
>> pa_dest = Tower.Feed()
>> 
>> cd ..
/stab
>> Stage_9.pa_source.Port -> Stage_7.pa_dest.Port
>> 
>> /overhead = Stream.Stream_Material()
>> /overhead.In -> Stage_0.l.Port
>> 
>> /bottoms = Stream.Stream_Material()
>> /bottoms.In -> Stage_11.l.Port
>> 
>> 
>> 
>> TryToSolve = 1  # start calculation
Calculating Jacobian for /stab
Calculating disturbance 10 of 13 in jacobian of /stab
/stab Inner Error 0.109677
/stab Inner Error 0.034979
/stab Inner Error 0.008833
/stab Inner Error 0.004038
/stab Inner Error 0.000916
/stab Inner Error 0.000347
/stab Inner Error 0.000018
/stab Inner Error 0.000002
Inner loop converged
/stab Iteration 1 Outer Error 0.125378
/stab Inner Error 0.050456
/stab Inner Error 0.020600
/stab Inner Error 0.008890
/stab Inner Error 0.000694
/stab Inner Error 0.000577
/stab Inner Error 0.000042
/stab Inner Error 0.000002
Inner loop converged
/stab Iteration 2 Outer Error 0.002443
/stab Inner Error 0.005573
/stab Inner Error 0.000499
/stab Inner Error 0.000230
/stab Inner Error 0.000005
Inner loop converged
/stab Iteration 3 Outer Error 0.000178
/stab Inner Error 0.000306
/stab Inner Error 0.000041
/stab Inner Error 0.000003
Inner loop converged
/stab Iteration 4 Outer Error 0.000010
/stab Inner Error 0.000040
/stab Inner Error 0.000006
Inner loop converged
>> 
>> /overhead.Out
Port: /overhead.Out + sim21.solver.Ports.Port_Material
Connected to: None
VapFrac            = 0.0 = 
T                  = 50.19575891885262 = C
P                  = 1000.0 = kPa
MoleFlow           = 431.33182047699626 = kgmole/h
MassFlow           = 22907.962176990422 = kg/h
VolumeFlow         = 49.74159864231957 = m3/hr
StdLiqVolumeFlow   = 39.79104898101609 = m3/hr
H                  = -137151.0815344613 = kJ/kmol
Energy             = -16432673.799624482 = W
MolecularWeight    = 53.10983575145726 = 
ZFactor            = 0.04289502116828703 = 
PROPANE            = 0.39434372505663223 = 
ISOBUTANE          = 0.3326774277859582 = 
N-BUTANE           = 0.23608171284362112 = 
ISOPENTANE         = 0.027795596104719766 = 
N-PENTANE          = 0.009003964575097126 = 
N-HEXANE           = 9.614359899001037e-05 = 
N-HEPTANE          = 1.4057547191435252e-06 = 
N-OCTANE           = 2.365610339810033e-08 = 
N-NONANE           = 2.024628148730572e-10 = 
N-DECANE           = 4.216961361353768e-10 = 

>> /bottoms.Out
Port: /bottoms.Out + sim21.solver.Ports.Port_Material
Connected to: None
VapFrac            = 1.841132633998474e-05 = 
T                  = 165.2452667166164 = C
P                  = 1100.0 = kPa
MoleFlow           = 568.6681795230044 = kgmole/h
MassFlow           = 53464.120721253494 = kg/h
VolumeFlow         = 119.3755743824271 = m3/hr
StdLiqVolumeFlow   = 80.00469666948885 = m3/hr
H                  = -180206.51609694364 = kJ/kmol
Energy             = -28466030.957508866 = W
MolecularWeight    = 94.01637483232997 = 
ZFactor            = 0.06335037504759733 = 
PROPANE            = 0.00018816452457851008 = 
ISOBUTANE          = 0.006692196923468509 = 
N-BUTANE           = 0.02 = 
ISOPENTANE         = 0.18395767285353473 = 
N-PENTANE          = 0.18062607908617465 = 
N-HEXANE           = 0.16927011862552535 = 
N-HEPTANE          = 0.14577814732449665 = 
N-OCTANE           = 0.12203951670828882 = 
N-NONANE           = 0.09812400609345877 = 
N-DECANE           = 0.07332923015507349 = 

>> L
[ 862.66364095  829.53025994  801.73267389  766.77098646  686.89097618
 2102.06108985 2155.77651036 2199.9591516  2224.83602619 2194.43113041
 2033.08954906  568.66817952]
>> V
[1.03473423e-40 1.29399546e+03 1.26086208e+03 1.23306449e+03
 1.19810281e+03 1.11822280e+03 1.53339291e+03 1.58710833e+03
 1.43129382e+03 1.45617069e+03 1.62576295e+03 1.46442137e+03]
>> T
[323.34575892 335.23133662 343.74082588 350.52513101 357.33259102
 369.48363799 379.71615415 388.50417862 395.40547867 403.33800472
 414.7647385  438.39526672]
>> 
>> # remove feed and draw and install VapourPumpAround object
>> TryToSolve = 0
>> delete Stage_9.pa_source
>> delete Stage_7.pa_dest
>> 
>> Stage_9.pa = Tower.VapourPumpAround(7)
>> Stage_7.pa_paR.Port.MoleFlow = 200
>> Stage_7.pa_paQ.Port.Energy = 0
>> TryToSolve = 1
/stab Inner Error 0.000001
Inner loop converged
/stab Iteration 1 Outer Error 0.000000
/stab Inner Error 0.000002
Inner loop converged
>> 
>> /overhead.Out
Port: /overhead.Out + sim21.solver.Ports.Port_Material
Connected to: None
VapFrac            = 0.0 = 
T                  = 50.195057317966246 = C
P                  = 1000.0 = kPa
MoleFlow           = 431.32196815146943 = kgmole/h
MassFlow           = 22907.317556067 = kg/h
VolumeFlow         = 49.740261749978735 = m3/hr
StdLiqVolumeFlow   = 39.78997426673652 = m3/hr
H                  = -137150.65373124395 = kJ/kmol
Energy             = -16432247.194616891 = W
MolecularWeight    = 53.10955437113916 = 
ZFactor            = 0.04289494115242908 = 
PROPANE            = 0.3943526569987985 = 
ISOBUTANE          = 0.3326822145668637 = 
N-BUTANE           = 0.23607908764922916 = 
ISOPENTANE         = 0.02778738379322921 = 
N-PENTANE          = 0.009001117782525053 = 
N-HEXANE           = 9.610977743939781e-05 = 
N-HEPTANE          = 1.40516364236687e-06 = 
N-OCTANE           = 2.364444275933634e-08 = 
N-NONANE           = 2.0234524530896819e-10 = 
N-DECANE           = 4.2148468456656233e-10 = 

>> /bottoms.Out
Port: /bottoms.Out + sim21.solver.Ports.Port_Material
Connected to: None
VapFrac            = 0.0 = 
T                  = 165.2435247863301 = C
P                  = 1100.0 = kPa
MoleFlow           = 568.6780318485305 = kgmole/h
MassFlow           = 53464.88240056939 = kg/h
VolumeFlow         = 119.35090605263626 = m3/hr
StdLiqVolumeFlow   = 80.00590250991861 = m3/hr
H                  = -180206.95342192453 = kJ/kmol
Energy             = -28466593.221499957 = W
MolecularWeight    = 94.01608538803197 = 
ZFactor            = 0.06333643837479301 = 
PROPANE            = 0.00018821869585672335 = 
ISOBUTANE          = 0.00669421400305637 = 
N-BUTANE           = 0.02 = 
ISOPENTANE         = 0.18396119609626277 = 
N-PENTANE          = 0.1806252649299403 = 
N-HEXANE           = 0.1692672133452045 = 
N-HEPTANE          = 0.14577562219623902 = 
N-OCTANE           = 0.12203740238750319 = 
N-NONANE           = 0.09812230609883411 = 
N-DECANE           = 0.07332795972908508 = 

>> Stage_7.pa_paR.Port
Port: /stab.Feed_7_pa_paR + sim21.solver.Ports.Port_Material
Connected to: None
VapFrac            = 0.9999989239542851 = 
T                  = 130.18621258340647 = C
P                  = 1081.8181818181818 = kPa
MoleFlow           = 200.0 * kgmole/h
MassFlow           = 14193.05172486421 = kg/h
VolumeFlow         = 498.2005760379157 = m3/hr
StdLiqVolumeFlow   = 22.97860686673769 = m3/hr
H                  = -136198.7981603099 = kJ/kmol
Energy             = -7566599.8977949945 = W
MolecularWeight    = 70.96525862432105 = 
ZFactor            = 0.8035762730745383 = 
PROPANE            = 0.0075737524761789405 = 
ISOBUTANE          = 0.07538083417671407 = 
N-BUTANE           = 0.14491698000891903 = 
ISOPENTANE         = 0.38746144856763487 = 
N-PENTANE          = 0.28192894908173727 = 
N-HEXANE           = 0.07076533299983838 = 
N-HEPTANE          = 0.020684979280543504 = 
N-OCTANE           = 0.007325735581269442 = 
N-NONANE           = 0.002854243191018282 = 
N-DECANE           = 0.001107744636146312 = 

>> L
[ 862.6439363   829.52150745  801.72879456  766.76774665  686.88537593
 2102.06930765 2155.77144729 2199.91988916 2224.74503938 2194.33701993
 2033.01444683  568.67803185]
>> V
[1.03468748e-40 1.29396590e+03 1.26084348e+03 1.23305076e+03
 1.19808971e+03 1.11820734e+03 1.53339128e+03 1.58709342e+03
 1.43124027e+03 1.45606542e+03 1.62565899e+03 1.46433641e+03]
>> T
[323.34505732 335.23008386 343.73904672 350.52299392 357.33034182
 369.48156774 379.71364357 388.50175875 395.403395   403.33621777
 414.76303498 438.39352479]
>> 
>> # delete the pump around
>> delete Stage_9.pa
Calculating Jacobian for /stab
Calculating disturbance 10 of 12 in jacobian of /stab
/stab Inner Error 0.031688
/stab Inner Error 0.005320
/stab Inner Error 0.000751
/stab Inner Error 0.000227
/stab Inner Error 0.000058
/stab Inner Error 0.000011
/stab Inner Error 0.000001
Inner loop converged
/stab Iteration 1 Outer Error 0.115730
/stab Inner Error 0.020840
/stab Inner Error 0.016671
/stab Inner Error 0.005173
/stab Inner Error 0.004352
/stab Inner Error 0.000618
/stab Inner Error 0.000124
/stab Inner Error 0.000024
/stab Inner Error 0.000001
Inner loop converged
/stab Iteration 2 Outer Error 0.002443
/stab Inner Error 0.002999
/stab Inner Error 0.000757
/stab Inner Error 0.000062
/stab Inner Error 0.000002
Inner loop converged
/stab Iteration 3 Outer Error 0.000173
/stab Inner Error 0.000176
/stab Inner Error 0.000023
/stab Inner Error 0.000001
Inner loop converged
/stab Iteration 4 Outer Error 0.000011
/stab Inner Error 0.000022
/stab Inner Error 0.000001
Inner loop converged
>> 
>> # add liquid pump down
>> Stage_7.pd = Tower.LiquidPumpAround(10)
>> Stage_7.pd.Port.MoleFlow = 300
>> Stage_10.pd_paQ.Port.Energy = 1000000
Calculating Jacobian for /stab
Calculating disturbance 10 of 13 in jacobian of /stab
/stab Inner Error 0.093796
/stab Inner Error 0.016017
/stab Inner Error 0.012418
/stab Inner Error 0.001457
/stab Inner Error 0.000419
/stab Inner Error 0.000037
/stab Inner Error 0.000008
Inner loop converged
/stab Iteration 1 Outer Error 0.130156
/stab Inner Error 0.027250
/stab Inner Error 0.021158
/stab Inner Error 0.021138
/stab Inner Error 0.010664
/stab Inner Error 0.001503
/stab Inner Error 0.000366
/stab Inner Error 0.000064
/stab Inner Error 0.000007
Inner loop converged
/stab Iteration 2 Outer Error 0.002741
/stab Inner Error 0.005613
/stab Inner Error 0.000585
/stab Inner Error 0.000150
/stab Inner Error 0.000016
/stab Inner Error 0.000003
Inner loop converged
/stab Iteration 3 Outer Error 0.000199
/stab Inner Error 0.000697
/stab Inner Error 0.000057
/stab Inner Error 0.000012
/stab Inner Error 0.000002
Inner loop converged
/stab Iteration 4 Outer Error 0.000011
/stab Inner Error 0.000062
/stab Inner Error 0.000007
Inner loop converged
>> /overhead.Out
Port: /overhead.Out + sim21.solver.Ports.Port_Material
Connected to: None
VapFrac            = 0.0 = 
T                  = 50.40129571095753 = C
P                  = 1000.0 = kPa
MoleFlow           = 433.14109464376804 = kgmole/h
MassFlow           = 23045.768444088833 = kg/h
VolumeFlow         = 50.01286720391647 = m3/hr
StdLiqVolumeFlow   = 40.00849108635741 = m3/hr
H                  = -137302.26520233095 = kJ/kmol
Energy             = -16519792.624112936 = W
MolecularWeight    = 53.20614618397846 = 
ZFactor            = 0.04292151421332575 = 
PROPANE            = 0.39252146959074496 = 
ISOBUTANE          = 0.33037072002602125 = 
N-BUTANE           = 0.23518018775031918 = 
ISOPENTANE         = 0.03148840941869423 = 
N-PENTANE          = 0.010328320360220626 = 
N-HEXANE           = 0.00010924847678075112 = 
N-HEPTANE          = 1.6160112678486772e-06 = 
N-OCTANE           = 2.762524187660149e-08 = 
N-NONANE           = 2.410367527101649e-10 = 
N-DECANE           = 4.996725689621208e-10 = 

>> /bottoms.Out
Port: /bottoms.Out + sim21.solver.Ports.Port_Material
Connected to: None
VapFrac            = 2.109405928637559e-05 = 
T                  = 165.32246533870784 = C
P                  = 1100.0 = kPa
MoleFlow           = 566.8589053562316 = kgmole/h
MassFlow           = 53326.29762479433 = kg/h
VolumeFlow         = 119.06139136392795 = m3/hr
StdLiqVolumeFlow   = 79.78723570676469 = m3/hr
H                  = -180263.10698277122 = kJ/kmol
Energy             = -28384374.30565749 = W
MolecularWeight    = 94.07331722394383 = 
ZFactor            = 0.06337415088285718 = 
PROPANE            = 0.0003225158651594625 = 
ISOBUTANE          = 0.007414304776667397 = 
N-BUTANE           = 0.02 = 
ISOPENTANE         = 0.181634397736226 = 
N-PENTANE          = 0.18016190457334916 = 
N-HEXANE           = 0.16980006679914608 = 
N-HEPTANE          = 0.14624327016087732 = 
N-OCTANE           = 0.12242903371300025 = 
N-NONANE           = 0.0984371937502343 = 
N-DECANE           = 0.07356327895627875 = 

>> Stage_10.pd_paR.Port
Port: /stab.Feed_10_pd_paR + sim21.solver.Ports.Port_Material
Connected to: None
VapFrac            = 0.0 = 
T                  = 57.54686094035287 = C
P                  = 1063.6363636363637 = kPa
MoleFlow           = 299.9986684233414 = kgmole/h
MassFlow           = 22693.902865749416 = kg/h
VolumeFlow         = 42.05546171738061 = m3/hr
StdLiqVolumeFlow   = 36.050616682081284 = m3/hr
H                  = -176436.42033324752 = kJ/kmol
Energy             = -14702969.767043116 = W
MolecularWeight    = 75.64667865033667 = 
ZFactor            = 0.05422905011446261 = 
PROPANE            = 0.01287871035194356 = 
ISOBUTANE          = 0.08107329635354545 = 
N-BUTANE           = 0.13528893396655217 = 
ISOPENTANE         = 0.3215683006553845 = 
N-PENTANE          = 0.2361276846035008 = 
N-HEXANE           = 0.08248899491602396 = 
N-HEPTANE          = 0.0486312457301747 = 
N-OCTANE           = 0.03553338773462202 = 
N-NONANE           = 0.02690296756720005 = 
N-DECANE           = 0.019506478121052807 = 

>> L
[ 866.28218929  830.764836    801.89283205  767.19700679  688.78687445
 2106.66195156 2164.70086671 1912.84512599 1931.20490292 1897.92331399
 2170.07512123  566.85890536]
>> V
[1.18637284e-40 1.29942328e+03 1.26390593e+03 1.23503393e+03
 1.20033810e+03 1.12192797e+03 1.53980305e+03 1.59784196e+03
 1.64598489e+03 1.66434467e+03 1.63106308e+03 1.60321622e+03]
>> T
[323.55129571 335.76438819 344.60736144 351.6266905  358.51073206
 370.51247804 381.01986741 389.83529726 397.52117898 404.57940171
 414.08733404 438.47246534]
>> 
